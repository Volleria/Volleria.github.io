<!DOCTYPE html>
<html lang="zh-cmn-Hans">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>基于Unity和MySQL的数据库课设 | Volleria 个人博客</title>
  
    <link rel="icon" href="/assets/rubbish.png">
  
  
  
  <!--link rel="stylesheet" href="//cdn.jsdelivr.net/highlight.js/9.10.0/styles/github-gist.min.css"-->
  
<link rel="stylesheet" href="//cdn.jsdelivr.net/highlight.js/9.10.0/styles/github-gist.min.css">

  
<link rel="stylesheet" href="/css/style.css">

<meta name="generator" content="Hexo 6.2.0"><style>mjx-container[jax="SVG"] {
  direction: ltr;
}

mjx-container[jax="SVG"] > svg {
  overflow: visible;
}

mjx-container[jax="SVG"][display="true"] {
  display: block;
  text-align: center;
  margin: 1em 0;
}

mjx-container[jax="SVG"][justify="left"] {
  text-align: left;
}

mjx-container[jax="SVG"][justify="right"] {
  text-align: right;
}

g[data-mml-node="merror"] > g {
  fill: red;
  stroke: red;
}

g[data-mml-node="merror"] > rect[data-background] {
  fill: yellow;
  stroke: none;
}

g[data-mml-node="mtable"] > line[data-line] {
  stroke-width: 70px;
  fill: none;
}

g[data-mml-node="mtable"] > rect[data-frame] {
  stroke-width: 70px;
  fill: none;
}

g[data-mml-node="mtable"] > .mjx-dashed {
  stroke-dasharray: 140;
}

g[data-mml-node="mtable"] > .mjx-dotted {
  stroke-linecap: round;
  stroke-dasharray: 0,140;
}

g[data-mml-node="mtable"] > svg {
  overflow: visible;
}

[jax="SVG"] mjx-tool {
  display: inline-block;
  position: relative;
  width: 0;
  height: 0;
}

[jax="SVG"] mjx-tool > mjx-tip {
  position: absolute;
  top: 0;
  left: 0;
}

mjx-tool > mjx-tip {
  display: inline-block;
  padding: .2em;
  border: 1px solid #888;
  font-size: 70%;
  background-color: #F8F8F8;
  color: black;
  box-shadow: 2px 2px 5px #AAAAAA;
}

g[data-mml-node="maction"][data-toggle] {
  cursor: pointer;
}

mjx-status {
  display: block;
  position: fixed;
  left: 1em;
  bottom: 1em;
  min-width: 25%;
  padding: .2em .4em;
  border: 1px solid #888;
  font-size: 90%;
  background-color: #F8F8F8;
  color: black;
}

foreignObject[data-mjx-xml] {
  font-family: initial;
  line-height: normal;
  overflow: visible;
}

.MathJax path {
  stroke-width: 3;
}

mjx-container[display="true"] {
  overflow: auto hidden;
}

mjx-container[display="true"] + br {
  display: none;
}
</style><link rel="alternate" href="/atom.xml" title="Volleria 个人博客" type="application/atom+xml">
</head>

<body>
<div class="Shell">
    <aside class='SideBar'>
    <section class='avatar' style="background-image: url(/assets/back222.jpg)">
        <div class='av-pic' style="background-image: url(/assets/header.png)">
        </div>
    </section>
    <section class='menu'>
        <div>Volleria 个人博客</div>
        
        <ul>
          
            <a href="/" class="Btn">
              <li>Home</li>
            </a>  
          
            <a href="/archives/" class="Btn">
              <li>Archive</li>
            </a>  
          
            <a href="/tags/" class="Btn">
              <li>Tags</li>
            </a>  
          
            <a href="/categories/" class="Btn">
              <li>Categories</li>
            </a>  
          
            <a href="/about/" class="Btn">
              <li>About</li>
            </a>  
          
        </ul>
    </section>
    <section class="media">
        
            
                <a target="_blank" rel="noopener" href="https://github.com/Volleria || back333.jpg">
                    <img src="/assets/GitHub.svg" />
                </a>
            
        
            
                <a href="mailto:EKKO0908@outlook.com">
                    <img src="/assets/E-Mail.svg" />
                </a>
            
        
    </section>
</aside>

    <div class="container">
        <div data-pager-shell>
            <div>
  <article class='ContentView'>
    <header class='PageTitle'>
        <h1>基于Unity和MySQL的数据库课设</h1>
    </header>

    <section>
      <p>(前排提示:为了凑字数导致内容较水)</p>
<h4 id="摘要"><a href="#摘要" class="headerlink" title="摘要"></a>摘要</h4><p>本实验采用的数据库为MySQL数据库，其具有体积小、速度快等优点。本实验的GUI部分采用Unity3D引擎制作，通过编写C#脚本挂载到Unity引擎中，实现了Unity与MySQL之间的连接。在完成基础实验一至五的前提上，依照要求实现了一个小型书籍信息管理系统 ，具有增删改查等基本功能，同时还可以根据一定要求进行排序，并且创建了两个图表对数据信息进行汇总，便于后续分析。</p>
<h4 id="关键词"><a href="#关键词" class="headerlink" title="关键词"></a>关键词</h4><p>MySQL、Unity、、C#、书籍信息管理</p>
<span id="more"></span>
<h2 id="一、实验要求"><a href="#一、实验要求" class="headerlink" title="一、实验要求"></a><strong>一、实验要求</strong></h2><ul>
<li>理解 SQL 定义功能</li>
<li>熟练掌握 SQL 操纵功能</li>
<li>了解 SQL 数据控制功能。</li>
<li>熟练掌握 Oracle、SQL Server、MySQL、DB2、Sybase 或 PostgreSQL 等对数据库的管理和操作，可以采用华为 OpenGauss 数据库。熟练掌握 Visual C++(MFC)、C#、 Qt、Java、PHP 或 Python 等访问数据库的方法，编写学生通讯录或学生选课（不建议）或其他类似的一个小型管理信息系统。</li>
</ul>
<p><strong>【关于小型管理信息系统】</strong></p>
<p>熟练掌握 Visual C++、C#、Qt、Java、PHP 或 Python 等访问数据库的方法， 设计和实现学生通讯录或学生选课或类似的一个小型管理信息系统。要求具有数 据的增加、删除、修改和查询的基本功能，并尽可能提供较多的查询功能，集成 一半以上实验一～实验五的功能，用户界面要友好。可选内容（加分项）：数据库中存放 100 万条记录，测试访问时间；如效率较低，提供优化方案。</p>
<h2 id="二、实验依赖"><a href="#二、实验依赖" class="headerlink" title="二、实验依赖"></a><strong>二、实验依赖</strong></h2><h3 id="1、MySQL"><a href="#1、MySQL" class="headerlink" title="1、MySQL"></a>1、MySQL</h3><h4 id="Ⅰ、MySQL-特点"><a href="#Ⅰ、MySQL-特点" class="headerlink" title="Ⅰ、MySQL 特点"></a>Ⅰ、MySQL 特点</h4><ul>
<li>功能强大</li>
<li>支持跨平台</li>
<li>运行速度快</li>
<li>支持面向对象</li>
<li>安全性高</li>
<li>成本低</li>
<li>支持各种开发语言</li>
<li>数据库存储容量大</li>
<li>支持强大的内置函数</li>
</ul>
<h4 id="Ⅱ、MySQL版本"><a href="#Ⅱ、MySQL版本" class="headerlink" title="Ⅱ、MySQL版本"></a>Ⅱ、MySQL版本</h4><p>本实验采用 MySQL 8.0版本</p>
<p>安装地址：<a target="_blank" rel="noopener" href="https://dev.mysql.com/downloads/installer/">https://dev.mysql.com/downloads/installer/</a></p>
<p>安装包：</p>
<p><img src="https://s2.loli.net/2022/07/26/nm5XEajiLsUZGFK.png" alt="image-20220628001737326"></p>
<h3 id="2、Unity"><a href="#2、Unity" class="headerlink" title="2、Unity"></a>2、Unity</h3><p>Unity 是实时3D互动内容创作和运营平台  。包括游戏开发、美术、建筑、汽车设计、影视在内的所有创作者，借助Unity将创意变成现实。Unity平台提供一整套完善的软件解决方案，可用于创作、运营和变现任何实时互动的2D和3D内容，支持平台包括手机、平板电脑、PC、游戏主机、增强现实和虚拟现实设备。</p>
<p>本实验采用Unity制作GUI界面 ，全部代码均在Unity中通过C#编写，</p>
<p>所用Unity编辑器的版本为  2021.2.7f1c1，渲染管线为 Built-in 渲染管线，新建项目类型为普通3D项目，所以代码编辑器为 Visual Studio 2019。</p>
<h3 id="3、相关参考资料"><a href="#3、相关参考资料" class="headerlink" title="3、相关参考资料"></a>3、相关参考资料</h3><p>MySQL的安装：<a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_59636442/article/details/123058454">https://blog.csdn.net/qq_59636442/article/details/123058454</a></p>
<p>PHP与MySQL的连接：<a target="_blank" rel="noopener" href="http://c.biancheng.net/view/7668.html">http://c.biancheng.net/view/7668.html</a></p>
<p>Unity连接MySQL：</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/Caijingxiang/article/details/107325645">https://blog.csdn.net/Caijingxiang/article/details/107325645</a></p>
<p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/508391104">https://zhuanlan.zhihu.com/p/508391104</a></p>
<h2 id="三、数据部分"><a href="#三、数据部分" class="headerlink" title="三、数据部分"></a><strong>三、数据部分</strong></h2><h4 id="1、数据来源"><a href="#1、数据来源" class="headerlink" title="1、数据来源"></a>1、数据来源</h4><p>本实验完成了一个书籍信息管理系统，其中书籍和作者信息为在豆瓣读书网页中爬取所得</p>
<p><strong>【方法】</strong></p>
<p>用python编写网络爬虫</p>
<h5 id="（1）设置url"><a href="#（1）设置url" class="headerlink" title="（1）设置url"></a>（1）设置url</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">url = <span class="string">"https://book.douban.com/subject/35635639"</span></span><br></pre></td></tr></table></figure>
<p>后面的数字 35635639 为豆瓣数据库中对每个书籍的编号</p>
<p>通过改变数字来获取书籍信息</p>
<h5 id="（2）建立请求，获取源代码"><a href="#（2）建立请求，获取源代码" class="headerlink" title="（2）建立请求，获取源代码"></a>（2）建立请求，获取源代码</h5> <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">r = requests.get(url, headers={<span class="string">'user-agent'</span>: <span class="string">'Mozilla/5.0'</span>})</span><br></pre></td></tr></table></figure>
<p>注意：必须在 url 后面加上 headers ，否则请求会被拒绝。</p>
<h5 id="（3）根据网页源代码，构建查匹配对应数据所需的正则表达式"><a href="#（3）根据网页源代码，构建查匹配对应数据所需的正则表达式" class="headerlink" title="（3）根据网页源代码，构建查匹配对应数据所需的正则表达式"></a>（3）根据网页源代码，构建查匹配对应数据所需的正则表达式</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">pattern1 = re.<span class="built_in">compile</span>(<span class="string">'&lt;meta name="keywords" content="(.*?)"&gt;'</span>) <span class="comment"># 基本信息</span></span><br><span class="line">pattern2 = re.<span class="built_in">compile</span>(<span class="string">'&lt;strong class="ll rating_num " property="v:average"&gt; (.*?) &lt;/strong&gt;'</span>) <span class="comment"># 豆瓣评分</span></span><br><span class="line">pettern3 = re.<span class="built_in">compile</span>(<span class="string">'&lt;a class="" href="/search/%E9%87%91%E5%86%89"&gt;(.*?)&lt;/a&gt;'</span>) <span class="comment"># 译者，有的书此处为空</span></span><br></pre></td></tr></table></figure>
<h5 id="（4）进行匹配查询"><a href="#（4）进行匹配查询" class="headerlink" title="（4）进行匹配查询"></a>（4）进行匹配查询</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">data = re.findall(pattern1, r.text)</span><br><span class="line">star = re.findall(pattern2, r.text)</span><br><span class="line">translate = re.findall(pettern3, r.text)</span><br></pre></td></tr></table></figure>
<h5 id="（5）字符串连接"><a href="#（5）字符串连接" class="headerlink" title="（5）字符串连接"></a>（5）字符串连接</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">str</span> = <span class="string">'insert into books values ("'</span> + s[<span class="number">0</span>] + <span class="string">'","'</span> + s[<span class="number">1</span>] + <span class="string">'","'</span> + s[<span class="number">2</span>] + <span class="string">'","'</span> + s[<span class="number">3</span>] + <span class="string">'",'</span> + <span class="string">' "无" ,"'</span> + star[</span><br><span class="line">    <span class="number">0</span>] + <span class="string">'" , "未借出");'</span></span><br></pre></td></tr></table></figure>
<p>将上述爬取到的信息连接起来，形成一条具有插入功能的MySQL语句，方便后续运行。</p>
<p><strong>【输出案例】</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">insert into books values (<span class="string">"法治的细节"</span>,<span class="string">"罗翔"</span>,<span class="string">"云南人民出版社"</span>,<span class="string">"2021-11"</span>, <span class="string">"无"</span> ,<span class="string">"8.4"</span> , <span class="string">"未借出"</span>);</span><br></pre></td></tr></table></figure>
<p><strong>【一些问题】</strong></p>
<p>豆瓣对书籍及作者信息有时收集的并不完全，导致爬取到的数据很少有能用的。</p>
<p>下图是一个完整的书籍信息，书籍编号为 35635639</p>
<p><img src="https://s2.loli.net/2022/07/26/tCewRjis3lNJYcT.png" alt="image-20220628003009895" style="zoom: 67%;"></p>
<p>下图书籍缺少豆瓣评分信息，书籍编号为 35635619</p>
<p><img src="https://s2.loli.net/2022/07/26/UIAQMxNSLcoOuYi.png" alt="image-20220628003116521" style="zoom:67%;"></p>
<p><strong>【解决方法】</strong></p>
<p>在大批量爬取数据后，手动删除无用信息，留下具有完整信息的书籍，将其写入到数据库中。</p>
<h4 id="2、详细数据"><a href="#2、详细数据" class="headerlink" title="2、详细数据"></a>2、详细数据</h4><h5 id="（1）书籍信息"><a href="#（1）书籍信息" class="headerlink" title="（1）书籍信息"></a>（1）书籍信息</h5><p>书籍信息表 books，具有以下7个属性</p>
<ul>
<li>书名 （主属性）</li>
<li>作者</li>
<li>出版社</li>
<li>出版时间</li>
<li>译者 （可无）</li>
<li>豆瓣评分</li>
<li>借阅状态</li>
</ul>
<p>使用如下sql语句创建</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> books</span><br><span class="line">(</span><br><span class="line">    bookname <span class="type">CHAR</span>(<span class="number">40</span>) <span class="keyword">Primary</span> key,</span><br><span class="line">    author <span class="type">CHAR</span>(<span class="number">40</span>) ,</span><br><span class="line">    producer <span class="type">CHAR</span>(<span class="number">40</span>),</span><br><span class="line">    producetime <span class="type">CHAR</span>(<span class="number">40</span>),</span><br><span class="line">    translater <span class="type">CHAR</span>(<span class="number">40</span>) ,</span><br><span class="line">    star <span class="type">CHAR</span>(<span class="number">10</span>),</span><br><span class="line">    borrowstate <span class="type">CHAR</span>(<span class="number">20</span>),</span><br><span class="line">    <span class="keyword">foreign</span> key(auther) <span class="keyword">references</span> authors(authorname)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<p>在MySQL中存储如下 （仅部分数据）</p>
<p><img src="https://s2.loli.net/2022/07/26/SxlD234weuskIJT.png" alt="image-20220628003930333"></p>
<h5 id="（2）作者信息"><a href="#（2）作者信息" class="headerlink" title="（2）作者信息"></a>（2）作者信息</h5><p>作者信息表 authors ，具有如下 5个属性</p>
<ul>
<li>作者姓名</li>
<li>作者性别</li>
<li>出生日期</li>
<li>出生地</li>
<li>国籍</li>
</ul>
<p>使用如下 sql 语句创建</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> authers</span><br><span class="line">(</span><br><span class="line">    auther <span class="type">CHAR</span>(<span class="number">40</span>) <span class="keyword">Primary</span> key,</span><br><span class="line">    sex <span class="type">CHAR</span>(<span class="number">40</span>) ,</span><br><span class="line">    birthtime <span class="type">CHAR</span>(<span class="number">40</span>),</span><br><span class="line">    birtharea <span class="type">CHAR</span>(<span class="number">40</span>),</span><br><span class="line">    country <span class="type">CHAR</span>(<span class="number">10</span>) ,</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<p>在MySQL中存储如下 （仅部分数据）</p>
<p><img src="https://s2.loli.net/2022/07/26/GN9cS2QsjagKzZH.png" alt="image-20220628004555717"></p>
<h5 id="（3）学生信息"><a href="#（3）学生信息" class="headerlink" title="（3）学生信息"></a>（3）学生信息</h5><p>学生信息表 students ，具有如下 5个属性</p>
<ul>
<li>学生姓名</li>
<li>学号</li>
<li>性别</li>
<li>系别</li>
<li>借阅书籍</li>
</ul>
<p>使用如下 sql 语句创建</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> students</span><br><span class="line">(</span><br><span class="line">    name <span class="type">CHAR</span>(<span class="number">20</span>),</span><br><span class="line">    Sno <span class="type">CHAR</span>(<span class="number">10</span>),</span><br><span class="line">    Sex <span class="type">CHAR</span>(<span class="number">10</span>),</span><br><span class="line">    Sdept <span class="type">CHAR</span>(<span class="number">10</span>),</span><br><span class="line">    book <span class="type">CHAR</span>(<span class="number">20</span>),</span><br><span class="line">    <span class="keyword">FOREIGN</span> KEY (book) <span class="keyword">REFERENCES</span> books(bookname),</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<p>在MySQL中存储如下 （仅部分数据）</p>
<p><img src="https://s2.loli.net/2022/07/26/t39EHslpx4yQm1Z.png" alt="image-20220628004942659"></p>
<h4 id="3、数据-E-R-图"><a href="#3、数据-E-R-图" class="headerlink" title="3、数据 E-R 图"></a>3、数据 E-R 图</h4><p><img src="https://s2.loli.net/2022/07/26/v32aFtNdSg7wZxf.png" alt="image-20220628010920001"></p>
<h2 id="四、具体实验流程"><a href="#四、具体实验流程" class="headerlink" title="四、具体实验流程"></a><strong>四、具体实验流程</strong></h2><h3 id="1、建立-Unity-与-MySQL-之间的连接"><a href="#1、建立-Unity-与-MySQL-之间的连接" class="headerlink" title="1、建立 Unity 与 MySQL 之间的连接"></a>1、建立 Unity 与 MySQL 之间的连接</h3><p>创建 C# 脚本 SqlAccess.cs ，完整代码如下，具体结束见注释</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"><span class="keyword">using</span> System.Data;</span><br><span class="line"><span class="keyword">using</span> MySql.Data.MySqlClient;</span><br><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"><span class="keyword">using</span> System.Text;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">SqlAccess</span></span><br><span class="line">{</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> MySqlConnection dbConnection;</span><br><span class="line">    <span class="comment">//如果只是在本地的话，写localhost就可以。</span></span><br><span class="line">    <span class="comment">// static string host = "localhost";  </span></span><br><span class="line">    <span class="comment">//如果是局域网，那么写上本机的局域网IP</span></span><br><span class="line">    <span class="keyword">static</span> <span class="built_in">string</span> host = <span class="string">"localhost"</span>;</span><br><span class="line">    <span class="keyword">static</span> <span class="built_in">string</span> port = <span class="string">"3306"</span>;</span><br><span class="line">    <span class="keyword">static</span> <span class="built_in">string</span> username = <span class="string">"root"</span>;</span><br><span class="line">    <span class="keyword">static</span> <span class="built_in">string</span> pwd = <span class="string">"HUNXIGUILAI2019"</span>;</span><br><span class="line">    <span class="keyword">static</span> <span class="built_in">string</span> database = <span class="string">"ekkodb"</span>;</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">SqlAccess</span>()</span></span><br><span class="line">    {</span><br><span class="line">        OpenSql();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">	<span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">	<span class="comment"><span class="doctag">///</span> 连接数据库</span></span><br><span class="line">	<span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">OpenSql</span>()</span></span><br><span class="line">	{</span><br><span class="line">	    <span class="keyword">try</span></span><br><span class="line">	    {</span><br><span class="line">	        <span class="built_in">string</span> connectionString = <span class="built_in">string</span>.Format(<span class="string">"server = {0};port={1};database = {2};user = {3};password = {4};charset=utf8"</span>, host, port, database, username, pwd);</span><br><span class="line">	        Debug.Log(<span class="string">"connectionString:"</span>+ connectionString);</span><br><span class="line">	        dbConnection = <span class="keyword">new</span> MySqlConnection(connectionString);</span><br><span class="line">	        dbConnection.Open();</span><br><span class="line">	        Debug.Log(<span class="string">"建立连接"</span>);</span><br><span class="line">	    }</span><br><span class="line">	    <span class="keyword">catch</span> (Exception e)</span><br><span class="line">	    {</span><br><span class="line">	        <span class="keyword">throw</span> <span class="keyword">new</span> Exception(<span class="string">"服务器连接失败,请重新检查是否打开MySql服务。"</span> + e.Message.ToString());</span><br><span class="line">	    }</span><br><span class="line">	}</span><br><span class="line">	</span><br><span class="line">	<span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">	<span class="comment"><span class="doctag">///</span> 关闭数据库连接</span></span><br><span class="line">	<span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Close</span>()</span></span><br><span class="line">	{</span><br><span class="line">	    <span class="keyword">if</span> (dbConnection != <span class="literal">null</span>)</span><br><span class="line">	    {</span><br><span class="line">	        dbConnection.Close();</span><br><span class="line">	        dbConnection.Dispose();</span><br><span class="line">	        dbConnection = <span class="literal">null</span>;</span><br><span class="line">	    }</span><br><span class="line">	}</span><br><span class="line">	</span><br><span class="line">	<span class="comment">// 增加操作</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> DataSet <span class="title">Additem</span>(<span class="params"><span class="built_in">string</span> tablename,<span class="built_in">string</span>[] datavalues</span>)</span></span><br><span class="line">	{</span><br><span class="line">		StringBuilder query = <span class="keyword">new</span> StringBuilder();</span><br><span class="line">		query.Append(<span class="string">"INSERT into "</span>);</span><br><span class="line">		query.Append(tablename);</span><br><span class="line">		query.Append(<span class="string">" VALUES ("</span>);</span><br><span class="line">		query.Append(<span class="string">"'"</span>);</span><br><span class="line">		query.Append(datavalues[<span class="number">0</span>]);</span><br><span class="line">		query.Append(<span class="string">"'"</span>);</span><br><span class="line">		<span class="keyword">for</span>(<span class="built_in">int</span> i = <span class="number">1</span>;i &lt;datavalues.Length;i++)</span><br><span class="line">		{</span><br><span class="line">			<span class="comment">// 判断类型</span></span><br><span class="line">			query.Append(<span class="string">",'"</span>);</span><br><span class="line">			query.Append(datavalues[i]);</span><br><span class="line">			query.Append(<span class="string">"'"</span>);</span><br><span class="line">		}</span><br><span class="line">		query.Append(<span class="string">");"</span>);</span><br><span class="line">		Debug.Log(<span class="string">"添加数据:"</span> + query.ToString());</span><br><span class="line">	    <span class="keyword">return</span> ExecuteQuery(query.ToString());</span><br><span class="line"></span><br><span class="line">	}</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 查询操作</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> DataSet <span class="title">SelectWhere</span>(<span class="params"><span class="built_in">string</span> tableName, <span class="built_in">string</span>[] items, <span class="built_in">string</span> bookname</span>)</span></span><br><span class="line">	{</span><br><span class="line">	    StringBuilder query = <span class="keyword">new</span> StringBuilder();</span><br><span class="line">	    query.Append(<span class="string">"SELECT "</span>);</span><br><span class="line">	    query.Append(items[<span class="number">0</span>]);</span><br><span class="line">	</span><br><span class="line">	    <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">1</span>; i &lt; items.Length; ++i)</span><br><span class="line">	    {</span><br><span class="line">	        query.Append(<span class="string">", "</span>);</span><br><span class="line">	        query.Append(items[i]);</span><br><span class="line">	    }</span><br><span class="line">	</span><br><span class="line">	    query.Append(<span class="string">" FROM "</span>);</span><br><span class="line">	    query.Append(tableName);</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span>( bookname != <span class="literal">null</span>)</span><br><span class="line">        {</span><br><span class="line">			query.Append(<span class="string">" WHERE "</span>);</span><br><span class="line">			query.Append(<span class="string">"bookname = "</span>);</span><br><span class="line">			query.Append(<span class="string">"'"</span>);</span><br><span class="line">			query.Append(bookname);</span><br><span class="line">			query.Append(<span class="string">"'"</span>);</span><br><span class="line">			query.Append(<span class="string">";"</span>);</span><br><span class="line">		}</span><br><span class="line">	    Debug.Log(<span class="string">"查询数据:"</span> + query.ToString());</span><br><span class="line">	    <span class="keyword">return</span> ExecuteQuery(query.ToString());</span><br><span class="line">	}</span><br><span class="line">	</span><br><span class="line">	<span class="comment">// 删除操作</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> DataSet <span class="title">Delete</span>(<span class="params"><span class="built_in">string</span> tablename,<span class="built_in">string</span> bookname</span>)</span></span><br><span class="line">    {</span><br><span class="line">		<span class="comment">// delete from books where bookname = "浮木";</span></span><br><span class="line">		StringBuilder query = <span class="keyword">new</span> StringBuilder();</span><br><span class="line">		query.Append(<span class="string">"DELETE FROM "</span>);</span><br><span class="line">		query.Append(tablename);</span><br><span class="line">		query.Append(<span class="string">" WHERE bookname = "</span>);</span><br><span class="line">		query.Append(<span class="string">"'"</span>);</span><br><span class="line">		query.Append(bookname);</span><br><span class="line">		query.Append(<span class="string">"'"</span>);</span><br><span class="line">		query.Append(<span class="string">";"</span>);</span><br><span class="line">		Debug.Log(<span class="string">"删除数据:"</span> + query.ToString());</span><br><span class="line">		<span class="keyword">return</span> ExecuteQuery(query.ToString());</span><br><span class="line"></span><br><span class="line">	}</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 执行 Sql 语句</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> DataSet <span class="title">ExecuteQuery</span>(<span class="params"><span class="built_in">string</span> sqlString</span>)</span></span><br><span class="line">	{</span><br><span class="line">	    <span class="keyword">if</span> (dbConnection.State == ConnectionState.Open)</span><br><span class="line">	    {</span><br><span class="line">	        DataSet ds = <span class="keyword">new</span> DataSet();</span><br><span class="line">	        <span class="keyword">try</span></span><br><span class="line">	        {</span><br><span class="line">	            MySqlDataAdapter da = <span class="keyword">new</span> MySqlDataAdapter(sqlString, dbConnection);</span><br><span class="line">	            da.Fill(ds);</span><br><span class="line">	        }</span><br><span class="line">	        <span class="keyword">catch</span> (Exception ee)</span><br><span class="line">	        {</span><br><span class="line">	            <span class="keyword">throw</span> <span class="keyword">new</span> Exception(<span class="string">"SQL:"</span> + sqlString + <span class="string">"/n"</span> + ee.Message.ToString());</span><br><span class="line">	        }</span><br><span class="line">	        <span class="keyword">finally</span></span><br><span class="line">	        {</span><br><span class="line">	        }</span><br><span class="line">	        <span class="keyword">return</span> ds;</span><br><span class="line">	    }</span><br><span class="line">	    <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">	}</span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="【踩坑记录】"><a href="#【踩坑记录】" class="headerlink" title="【踩坑记录】"></a>【踩坑记录】</h4><h5 id="1、连接问题"><a href="#1、连接问题" class="headerlink" title="1、连接问题"></a>1、连接问题</h5><p><img src="https://s2.loli.net/2022/07/26/FwWlIqbLJcP9Hte.png" alt="image-20220606171815558"></p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Exception: 服务器连接失败，请重新检查是否打开MySql服务。The given key <span class="string">'utf8mb4'</span> was <span class="keyword">not</span> present <span class="keyword">in</span> the dictionary.</span><br></pre></td></tr></table></figure>
<p>解决办法：</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 在string末尾添加 “charset=utf8”</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">string</span> connectionString = <span class="built_in">string</span>.Format(<span class="string">"server = {0};port={1};database = {2};user = {3};password = {4};charset=utf8"</span>, host, port, database, username, pwd);</span><br></pre></td></tr></table></figure>
<h5 id="2、查询问题"><a href="#2、查询问题" class="headerlink" title="2、查询问题"></a>2、查询问题</h5><h5 id="问题1"><a href="#问题1" class="headerlink" title="问题1"></a>问题1</h5><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Exception: SQL:<span class="keyword">select</span> cno, cname, cpno, ccredit <span class="keyword">from</span> c/nThe given key <span class="string">'utf8mb4'</span> was <span class="keyword">not</span> present <span class="keyword">in</span> the dictionary.</span><br></pre></td></tr></table></figure>
<p><img src="https://s2.loli.net/2022/07/26/iu8BYPfjsFJwSlr.png" alt="image-20220606171952042"></p>
<p><strong>主要原因：</strong></p>
<p>MySql.Data 的版本过低（此版本为5.2.7）</p>
<h5 id="问题2"><a href="#问题2" class="headerlink" title="问题2"></a>问题2</h5><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Exception: 服务器连接失败，请重新检查是否打开MySql服务。Authentication failed, see inner exception.</span><br></pre></td></tr></table></figure>
<p><img src="https://s2.loli.net/2022/07/26/Be3Tst1KX5rLmER.png" alt="image-20220606172208966"></p>
<p><strong>主要原因：</strong></p>
<p>MySql.Data 的版本过高（此版本为6.9.9）</p>
<h5 id="解决方法："><a href="#解决方法：" class="headerlink" title="解决方法："></a>解决方法：</h5><p>以上问题都是由于 MySql.Data.dll  的版本问题导致的</p>
<p>我所用的Unity版本为 2021.2.7f1c1</p>
<p>不同的 MySql.Data.dll 的下载地址： <a target="_blank" rel="noopener" href="https://downloads.mysql.com/archives/c-net/">https://downloads.mysql.com/archives/c-net/</a></p>
<p>经过多次实验</p>
<p><img src="https://s2.loli.net/2022/07/26/NhPbcVzuov37nQB.png" alt="image-20220606172506541"></p>
<p>找到的合适的 MySql.Data.dll  的版本为 6.1.6</p>
<p>成功建立连接并实现查询</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> Cno, Cname, Cpno, Ccredit <span class="keyword">FROM</span> C</span><br></pre></td></tr></table></figure>
<p><img src="https://s2.loli.net/2022/07/26/PXiT9d4qwNDhtRA.png" alt="image-20220606172751991"></p>
<p><img src="https://s2.loli.net/2022/07/26/TmGUED6y4pdlXa9.png" alt="image-20220606172726928" style="zoom:80%;"></p>
<h3 id="2、登陆界面"><a href="#2、登陆界面" class="headerlink" title="2、登陆界面"></a>2、登陆界面</h3><h4 id="Ⅰ、界面绘制及功能介绍"><a href="#Ⅰ、界面绘制及功能介绍" class="headerlink" title="Ⅰ、界面绘制及功能介绍"></a>Ⅰ、界面绘制及功能介绍</h4><p><img src="https://s2.loli.net/2022/07/26/Agt9WSxaBYCMKU4.png" alt="image-20220628011720929"></p>
<p><em>用户名</em> 与 <em>密码</em>  为两个 Input Field 组件，可以获取用户输入</p>
<p>用户输入 正确的用户名和密码后可登入数据库，若用户名或密码错误，会出现警告</p>
<p><img src="https://s2.loli.net/2022/07/26/C5tlpr87dA9k1Zg.png" alt="image-20220628011958371"></p>
<h4 id="Ⅱ、功能实现"><a href="#Ⅱ、功能实现" class="headerlink" title="Ⅱ、功能实现"></a>Ⅱ、功能实现</h4><h5 id="（1）引入所需命名空间"><a href="#（1）引入所需命名空间" class="headerlink" title="（1）引入所需命名空间"></a>（1）引入所需命名空间</h5><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System.Collections;</span><br><span class="line"><span class="keyword">using</span> System.Collections.Generic;</span><br><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"><span class="keyword">using</span> UnityEngine.UI;</span><br></pre></td></tr></table></figure>
<h5 id="（2）声明所需的各个变量"><a href="#（2）声明所需的各个变量" class="headerlink" title="（2）声明所需的各个变量"></a>（2）声明所需的各个变量</h5><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> GameObject cuowu;</span><br><span class="line"><span class="keyword">public</span> InputField zhanghao;</span><br><span class="line"><span class="keyword">public</span> InputField mima;</span><br><span class="line"><span class="keyword">public</span> Button queding_btn;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> GameObject maincanvas;</span><br><span class="line"></span><br><span class="line"><span class="built_in">string</span> zhanghaostr ;</span><br><span class="line"><span class="built_in">string</span> mimastr ;</span><br></pre></td></tr></table></figure>
<h5 id="（3）在启动时进行绑定与初始化设置"><a href="#（3）在启动时进行绑定与初始化设置" class="headerlink" title="（3）在启动时进行绑定与初始化设置"></a>（3）在启动时进行绑定与初始化设置</h5><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Start</span>()</span></span><br><span class="line">{</span><br><span class="line">    cuowu.SetActive(<span class="literal">false</span>);</span><br><span class="line">    maincanvas.SetActive(<span class="literal">false</span>);</span><br><span class="line">    queding_btn.onClick.AddListener(log);</span><br><span class="line">    mima.contentType = InputField.ContentType.Password;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<h5 id="（4）按钮触发的登陆操作"><a href="#（4）按钮触发的登陆操作" class="headerlink" title="（4）按钮触发的登陆操作"></a>（4）按钮触发的登陆操作</h5><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">log</span>()</span></span><br><span class="line">{</span><br><span class="line">    <span class="built_in">string</span> myzh = zhanghao.text;</span><br><span class="line">    <span class="built_in">string</span> mymima = mima.text;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>( <span class="built_in">string</span>.Compare(zhanghaostr,myzh)== <span class="number">0</span> &amp;&amp; <span class="built_in">string</span>.Compare(mimastr,mymima) == <span class="number">0</span> )</span><br><span class="line">    {</span><br><span class="line">        transform.gameObject.SetActive(<span class="literal">false</span>);</span><br><span class="line">        maincanvas.gameObject.SetActive(<span class="literal">true</span>);</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    {</span><br><span class="line">        cuowu.SetActive(<span class="literal">true</span>);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<h3 id="3、主界面"><a href="#3、主界面" class="headerlink" title="3、主界面"></a>3、主界面</h3><h4 id="Ⅰ、界面绘制及功能介绍-1"><a href="#Ⅰ、界面绘制及功能介绍-1" class="headerlink" title="Ⅰ、界面绘制及功能介绍"></a>Ⅰ、界面绘制及功能介绍</h4><p><img src="https://s2.loli.net/2022/07/26/p4EaV8k2nXm1oQy.png" alt="image-20220628012514967"></p>
<p>主界面一共有四个按钮事件，通过点击各个按钮显示对应的界面，左上角 <strong>×</strong> 为关闭整个应用程序，在程序打包后生效。</p>
<h4 id="Ⅱ、功能实现-1"><a href="#Ⅱ、功能实现-1" class="headerlink" title="Ⅱ、功能实现"></a>Ⅱ、功能实现</h4><h5 id="（1）引入命名空间"><a href="#（1）引入命名空间" class="headerlink" title="（1）引入命名空间"></a>（1）引入命名空间</h5><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System.Collections;</span><br><span class="line"><span class="keyword">using</span> System.Collections.Generic;</span><br><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"><span class="keyword">using</span> UnityEngine.UI;</span><br><span class="line"><span class="keyword">using</span> XCharts.Runtime;</span><br><span class="line"><span class="keyword">using</span> System.Data;</span><br></pre></td></tr></table></figure>
<h5 id="（2）初始化所需的各个变量及组件"><a href="#（2）初始化所需的各个变量及组件" class="headerlink" title="（2）初始化所需的各个变量及组件"></a>（2）初始化所需的各个变量及组件</h5><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> Button sbtn;</span><br><span class="line"><span class="keyword">public</span> Button abtn;</span><br><span class="line"><span class="keyword">public</span> Button alterbtn;</span><br><span class="line"><span class="keyword">public</span> Button showbtn;</span><br><span class="line"><span class="keyword">public</span> Button quitbnt;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> Canvas selcanva;</span><br><span class="line"><span class="keyword">public</span> Canvas addcanva;</span><br><span class="line"><span class="keyword">public</span> Canvas altercanva;</span><br><span class="line"><span class="keyword">public</span> Canvas showchartcanva;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> PieChart chart;</span><br><span class="line"><span class="keyword">public</span> BarChart barchart;</span><br><span class="line"><span class="keyword">private</span> Serie serie;</span><br><span class="line">ArrayList stars = <span class="keyword">new</span> ArrayList();</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> GameObject tablecanvas;</span><br><span class="line"><span class="keyword">public</span> GameObject table_prefab;</span><br><span class="line"><span class="keyword">private</span> GameObject mytable;</span><br></pre></td></tr></table></figure>
<h5 id="（3）对按钮、Canvas等组件进行初始化及绑定操作"><a href="#（3）对按钮、Canvas等组件进行初始化及绑定操作" class="headerlink" title="（3）对按钮、Canvas等组件进行初始化及绑定操作"></a>（3）对按钮、Canvas等组件进行初始化及绑定操作</h5><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Start</span>()</span></span><br><span class="line">{</span><br><span class="line">    selcanva.gameObject.SetActive(<span class="literal">false</span>);</span><br><span class="line">    addcanva.gameObject.SetActive(<span class="literal">false</span>);</span><br><span class="line">    altercanva.gameObject.SetActive(<span class="literal">false</span>);</span><br><span class="line">    showchartcanva.gameObject.SetActive(<span class="literal">false</span>);</span><br><span class="line"></span><br><span class="line">    sbtn.onClick.AddListener(showtable );</span><br><span class="line">    abtn.onClick.AddListener(<span class="built_in">delegate</span> { showandclose(addcanva); });</span><br><span class="line">    alterbtn.onClick.AddListener(<span class="built_in">delegate</span> { showandclose(altercanva); });</span><br><span class="line">    showbtn.onClick.AddListener(xiugai);</span><br><span class="line">    quitbnt.onClick.AddListener(tuchu);</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<h5 id="（4）关闭-显示-功能"><a href="#（4）关闭-显示-功能" class="headerlink" title="（4）关闭/显示 功能"></a>（4）关闭/显示 功能</h5><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">showandclose</span>(<span class="params">Canvas thiscanva</span>)</span></span><br><span class="line">{</span><br><span class="line">    selcanva.gameObject.SetActive(<span class="literal">false</span>);</span><br><span class="line">    addcanva.gameObject.SetActive(<span class="literal">false</span>);</span><br><span class="line">    altercanva.gameObject.SetActive(<span class="literal">false</span>);</span><br><span class="line">    showchartcanva.gameObject.SetActive(<span class="literal">false</span>);</span><br><span class="line"></span><br><span class="line">    thiscanva.gameObject.SetActive(<span class="literal">true</span>); </span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<h5 id="（5）退出应用程序"><a href="#（5）退出应用程序" class="headerlink" title="（5）退出应用程序"></a>（5）退出应用程序</h5><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">tuchu</span>()</span></span><br><span class="line">{</span><br><span class="line">    Application.Quit();</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<h5 id="（6）对第四部分的chart图表进行更新修改"><a href="#（6）对第四部分的chart图表进行更新修改" class="headerlink" title="（6）对第四部分的chart图表进行更新修改"></a>（6）对第四部分的chart图表进行更新修改</h5><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">xiugai</span>()</span></span><br><span class="line">{</span><br><span class="line">    <span class="built_in">int</span> a = <span class="number">0</span>;</span><br><span class="line">    <span class="built_in">int</span> b = <span class="number">0</span>;</span><br><span class="line">    <span class="built_in">int</span> c = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    selcanva.gameObject.SetActive(<span class="literal">false</span>);</span><br><span class="line">    addcanva.gameObject.SetActive(<span class="literal">false</span>);</span><br><span class="line">    altercanva.gameObject.SetActive(<span class="literal">false</span>);</span><br><span class="line">    showchartcanva.gameObject.SetActive(<span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">    SqlAccess sql = <span class="keyword">new</span> SqlAccess();</span><br><span class="line">    <span class="built_in">string</span>[] items = { <span class="string">"star"</span> };</span><br><span class="line">    <span class="built_in">string</span> tablename = <span class="string">"books"</span>;</span><br><span class="line">    <span class="built_in">string</span> bookname = <span class="literal">null</span>;</span><br><span class="line">    DataSet ds = sql.SelectWhere(tablename, items, bookname);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (ds != <span class="literal">null</span>)</span><br><span class="line">    {</span><br><span class="line">        DataTable table = ds.Tables[<span class="number">0</span>];</span><br><span class="line">        <span class="keyword">foreach</span> (DataRow row <span class="keyword">in</span> table.Rows)</span><br><span class="line">        {</span><br><span class="line">            <span class="built_in">string</span> str = <span class="string">""</span>;</span><br><span class="line">            <span class="keyword">foreach</span> (DataColumn column <span class="keyword">in</span> table.Columns)</span><br><span class="line">            {</span><br><span class="line">                str += row[column];</span><br><span class="line">                <span class="built_in">float</span> num = <span class="built_in">float</span>.Parse(str);</span><br><span class="line">                <span class="keyword">if</span> (num &gt;= <span class="number">9.0f</span>)</span><br><span class="line">                    a++;</span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">if</span> (num &lt;= <span class="number">8.0f</span>)</span><br><span class="line">                    c++;</span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                    b++;</span><br><span class="line">                <span class="comment">//stars.Add(float.Parse(str));</span></span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    chart.UpdateData(<span class="number">0</span>, <span class="number">0</span>, a);</span><br><span class="line">    chart.UpdateData(<span class="number">0</span>, <span class="number">1</span>, b);</span><br><span class="line">    chart.UpdateData(<span class="number">0</span>, <span class="number">2</span>, c);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> yAxis = barchart.GetChartComponent&lt;YAxis&gt;();</span><br><span class="line">    yAxis.minMaxType = Axis.AxisMinMaxType.Default;</span><br><span class="line"></span><br><span class="line">    barchart.RemoveData();</span><br><span class="line">    serie = barchart.AddSerie&lt;Bar&gt;(<span class="string">"Star"</span>);</span><br><span class="line"></span><br><span class="line">    barchart.AddXAxisData(<span class="string">"小于8.0"</span>);</span><br><span class="line">    barchart.AddData(<span class="number">0</span>, c);</span><br><span class="line">    barchart.AddXAxisData(<span class="string">"8.0-9.0"</span>);</span><br><span class="line">    barchart.AddData(<span class="number">0</span>, b);</span><br><span class="line">    barchart.AddXAxisData(<span class="string">"大于9.0"</span> );</span><br><span class="line">    barchart.AddData(<span class="number">0</span>, a);</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<h5 id="（7）通过预制体的不断删除实例化来更新"><a href="#（7）通过预制体的不断删除实例化来更新" class="headerlink" title="（7）通过预制体的不断删除实例化来更新"></a>（7）通过预制体的不断删除实例化来更新</h5><p>通过调用此函数解决了更新脚本只执行一次的bug</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">showtable</span>()</span></span><br><span class="line">{</span><br><span class="line">    Destroy(tablecanvas.transform.GetChild(<span class="number">0</span>).gameObject);</span><br><span class="line">    mytable = Instantiate(table_prefab);</span><br><span class="line">    mytable.transform.SetParent(tablecanvas.transform, <span class="literal">false</span>);</span><br><span class="line"></span><br><span class="line">    selcanva.gameObject.SetActive(<span class="literal">true</span>);</span><br><span class="line">    addcanva.gameObject.SetActive(<span class="literal">false</span>);</span><br><span class="line">    altercanva.gameObject.SetActive(<span class="literal">false</span>);</span><br><span class="line">    showchartcanva.gameObject.SetActive(<span class="literal">false</span>);</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<h3 id="4、选择查看界面"><a href="#4、选择查看界面" class="headerlink" title="4、选择查看界面"></a>4、选择查看界面</h3><h4 id="Ⅰ、界面绘制及功能介绍-2"><a href="#Ⅰ、界面绘制及功能介绍-2" class="headerlink" title="Ⅰ、界面绘制及功能介绍"></a>Ⅰ、界面绘制及功能介绍</h4><p><img src="https://s2.loli.net/2022/07/26/7aE3XNgDLSvyVP1.png" alt="image-20220628013418735"></p>
<p>此处程序尚未执行，表中全部为空</p>
<p><strong>【运行程序】</strong></p>
<p>点击 “书籍信息表”</p>
<p><img src="https://s2.loli.net/2022/07/26/WzFGOuXkn6Lsih4.png" alt="image-20220628013524407"></p>
<p>点击 “作者信息表”</p>
<p><img src="https://s2.loli.net/2022/07/26/jmQFwqgiu4NtbU3.png" alt="image-20220628013558654"></p>
<p>点击 “学生信息表”</p>
<p><img src="https://s2.loli.net/2022/07/26/glwCxHP9SfQuZqr.png" alt="image-20220628013619545"></p>
<p>此外，表中增加了排序功能</p>
<p>点击 “豆瓣评分” 表头，可以根据豆瓣评分高低进行升序排序</p>
<p><img src="https://s2.loli.net/2022/07/26/XrmahHi8VN21bDz.png" alt="image-20220628013745939"></p>
<p>点击 “豆瓣评分” 表头，可以根据豆瓣评分高低进行升序排序</p>
<p><img src="https://s2.loli.net/2022/07/26/IQ7rthGkeaWYU2o.png" alt="image-20220628013823061"></p>
<h4 id="Ⅱ、功能实现-2"><a href="#Ⅱ、功能实现-2" class="headerlink" title="Ⅱ、功能实现"></a>Ⅱ、功能实现</h4><h5 id="创建-Select-cs-脚本"><a href="#创建-Select-cs-脚本" class="headerlink" title="创建 Select.cs 脚本"></a>创建 Select.cs 脚本</h5><h6 id="（1）引入命名空间-1"><a href="#（1）引入命名空间-1" class="headerlink" title="（1）引入命名空间"></a>（1）引入命名空间</h6><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System.Collections;</span><br><span class="line"><span class="keyword">using</span> System.Collections.Generic;</span><br><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"><span class="keyword">using</span> UnityEngine.UI;</span><br></pre></td></tr></table></figure>
<h6 id="（2）初始化变量及组件"><a href="#（2）初始化变量及组件" class="headerlink" title="（2）初始化变量及组件"></a>（2）初始化变量及组件</h6><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> Button shubtn;</span><br><span class="line"><span class="keyword">public</span> Button autherbtn;</span><br><span class="line"><span class="keyword">public</span> Button studentbtn;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> GameObject shutable;</span><br><span class="line"><span class="keyword">public</span> GameObject authertable;</span><br><span class="line"><span class="keyword">public</span> GameObject studenttable;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> GameObject tablecanvas;</span><br><span class="line"><span class="keyword">public</span> GameObject tablecanvas1;</span><br><span class="line"><span class="keyword">public</span> GameObject table_prefab;</span><br><span class="line"><span class="keyword">public</span> GameObject table_prefab1;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> GameObject mytable;</span><br><span class="line"><span class="keyword">private</span> GameObject mytable1;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> GameObject tishi;</span><br></pre></td></tr></table></figure>
<h6 id="（3）变量初始化及按钮绑定"><a href="#（3）变量初始化及按钮绑定" class="headerlink" title="（3）变量初始化及按钮绑定"></a>（3）变量初始化及按钮绑定</h6><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Start</span>()</span></span><br><span class="line">{</span><br><span class="line">    shubtn.onClick.AddListener(showshu);</span><br><span class="line">    autherbtn.onClick.AddListener(showa);</span><br><span class="line">    studentbtn.onClick.AddListener(shows);      </span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<h6 id="（4）为各个按钮分配功能"><a href="#（4）为各个按钮分配功能" class="headerlink" title="（4）为各个按钮分配功能"></a>（4）为各个按钮分配功能</h6><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">showshu</span>()</span></span><br><span class="line">{</span><br><span class="line">    shutable.SetActive(<span class="literal">true</span>);</span><br><span class="line">    authertable.SetActive(<span class="literal">false</span>);</span><br><span class="line">    studenttable.SetActive(<span class="literal">false</span>);</span><br><span class="line">    tishi.SetActive(<span class="literal">true</span>);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">showa</span>()</span></span><br><span class="line">{</span><br><span class="line">    Destroy(tablecanvas.transform.GetChild(<span class="number">0</span>).gameObject);</span><br><span class="line">    mytable = Instantiate(table_prefab);</span><br><span class="line">    mytable.transform.SetParent(tablecanvas.transform, <span class="literal">false</span>);</span><br><span class="line"></span><br><span class="line">    shutable.SetActive(<span class="literal">false</span>);</span><br><span class="line">    studenttable.SetActive(<span class="literal">false</span>);</span><br><span class="line">    authertable.SetActive(<span class="literal">true</span>);</span><br><span class="line">    tishi.SetActive(<span class="literal">false</span>);</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">shows</span>()</span></span><br><span class="line">{</span><br><span class="line">    Destroy(tablecanvas1.transform.GetChild(<span class="number">0</span>).gameObject);</span><br><span class="line">    mytable1 = Instantiate(table_prefab1);</span><br><span class="line">    mytable1.transform.SetParent(tablecanvas1.transform, <span class="literal">false</span>);</span><br><span class="line">    mytable1.gameObject.SetActive(<span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">    shutable.SetActive(<span class="literal">false</span>);</span><br><span class="line">    authertable.SetActive(<span class="literal">false</span>);</span><br><span class="line">    studenttable.SetActive(<span class="literal">true</span>);</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<h5 id="为书籍信息表创建-example-cs-脚本"><a href="#为书籍信息表创建-example-cs-脚本" class="headerlink" title="为书籍信息表创建 example.cs 脚本"></a>为书籍信息表创建 example.cs 脚本</h5><h6 id="（1）引入命名空间-2"><a href="#（1）引入命名空间-2" class="headerlink" title="（1）引入命名空间"></a>（1）引入命名空间</h6><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System.Collections;</span><br><span class="line"><span class="keyword">using</span> System.Collections.Generic;</span><br><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"><span class="keyword">using</span> UnityEngine.UI;</span><br><span class="line"><span class="keyword">using</span> WDT;</span><br><span class="line"><span class="keyword">using</span> System.Data;</span><br><span class="line"><span class="keyword">using</span> System;</span><br></pre></td></tr></table></figure>
<h6 id="（2）初始化变量及组件-1"><a href="#（2）初始化变量及组件-1" class="headerlink" title="（2）初始化变量及组件"></a>（2）初始化变量及组件</h6><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> WDataTable dataTable;</span><br><span class="line"><span class="keyword">private</span> List&lt;IList&lt;<span class="built_in">object</span>&gt;&gt; m_datas = <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">private</span> List&lt;WColumnDef&gt; m_columnDefs = <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">private</span> <span class="built_in">int</span> m_tempSelectIndex = <span class="number">-1</span>;</span><br><span class="line">ArrayList stars = <span class="keyword">new</span> ArrayList();</span><br><span class="line"><span class="built_in">int</span> row_n;</span><br></pre></td></tr></table></figure>
<h6 id="（3）对表格进行赋值初始化"><a href="#（3）对表格进行赋值初始化" class="headerlink" title="（3）对表格进行赋值初始化"></a>（3）对表格进行赋值初始化</h6><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Start</span>()</span></span><br><span class="line">    {</span><br><span class="line">        SqlAccess sql = <span class="keyword">new</span> SqlAccess();</span><br><span class="line">        <span class="built_in">string</span>[] items = { <span class="string">"*"</span> };</span><br><span class="line">        <span class="built_in">string</span> tablename = <span class="string">"books"</span>;</span><br><span class="line">        <span class="built_in">string</span> bookname = <span class="literal">null</span>;</span><br><span class="line">        DataSet ds = sql.SelectWhere(tablename, items, bookname);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (ds != <span class="literal">null</span>)</span><br><span class="line">        {</span><br><span class="line">            DataTable table = ds.Tables[<span class="number">0</span>];</span><br><span class="line">            <span class="keyword">foreach</span> (DataRow row <span class="keyword">in</span> table.Rows)</span><br><span class="line">            {</span><br><span class="line">                <span class="comment">// string str = "";</span></span><br><span class="line">                <span class="keyword">foreach</span> (DataColumn column <span class="keyword">in</span> table.Columns)</span><br><span class="line">                {</span><br><span class="line">                    <span class="built_in">string</span> str = <span class="string">""</span>;</span><br><span class="line">                    str += row[column];</span><br><span class="line">                    stars.Add(str);</span><br><span class="line">                }</span><br><span class="line">                <span class="comment">// Debug.Log(str + "ee");</span></span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">        Debug.Log(<span class="string">"changdu:"</span> + stars.Count);</span><br><span class="line">        row_n = stars.Count / <span class="number">7</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">//table.onClick.AddListener(gengxin);</span></span><br><span class="line"></span><br><span class="line">        m_datas = <span class="keyword">new</span> List&lt;IList&lt;<span class="built_in">object</span>&gt;&gt;();</span><br><span class="line">        <span class="comment">// name is necessary in columnDefs</span></span><br><span class="line">        m_columnDefs = <span class="keyword">new</span> List&lt;WColumnDef&gt;</span><br><span class="line">        {</span><br><span class="line">            <span class="keyword">new</span> WColumnDef() {name = <span class="string">"书名"</span>,width = <span class="string">"15%"</span>},</span><br><span class="line">            <span class="keyword">new</span> WColumnDef() {name = <span class="string">"作者名"</span>,width = <span class="string">"20%"</span>},</span><br><span class="line">            <span class="keyword">new</span> WColumnDef() {name = <span class="string">"出版社"</span>,width = <span class="string">"19%"</span>},</span><br><span class="line">            <span class="keyword">new</span> WColumnDef() {name = <span class="string">"出版时间"</span>,width = <span class="string">"12%"</span>},</span><br><span class="line">            <span class="keyword">new</span> WColumnDef() {name = <span class="string">"译者"</span>,width = <span class="string">"11%"</span>},</span><br><span class="line">            <span class="keyword">new</span> WColumnDef() {name = <span class="string">"豆瓣评分"</span>,},</span><br><span class="line">            <span class="keyword">new</span> WColumnDef() {name = <span class="string">"借阅状态"</span>,},</span><br><span class="line">            <span class="comment">//new WColumnDef() {name = "译者", width = "50%", disableSort = true}</span></span><br><span class="line"></span><br><span class="line">        };</span><br><span class="line">        <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; row_n; i++)</span><br><span class="line">        {</span><br><span class="line">            m_datas.Add(GetRandomData(i));</span><br><span class="line">        }</span><br><span class="line">        dataTable.msgHandle += HandleTableEvent;</span><br><span class="line">        dataTable.InitDataTable(m_datas, m_columnDefs);</span><br><span class="line"></span><br><span class="line">    }</span><br></pre></td></tr></table></figure>
<h6 id="（4）实现表头排序功能的引入、实现表头界面颜色的更改"><a href="#（4）实现表头排序功能的引入、实现表头界面颜色的更改" class="headerlink" title="（4）实现表头排序功能的引入、实现表头界面颜色的更改"></a>（4）实现表头排序功能的引入、实现表头界面颜色的更改</h6><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">HandleTableEvent</span>(<span class="params">WEventType messageType, <span class="keyword">params</span> <span class="built_in">object</span>[] args</span>)</span></span><br><span class="line">{</span><br><span class="line">    <span class="keyword">if</span> (messageType == WEventType.INIT_ELEMENT)</span><br><span class="line">    {</span><br><span class="line">        <span class="built_in">int</span> rowIndex = (<span class="built_in">int</span>) args[<span class="number">0</span>];</span><br><span class="line">        <span class="built_in">int</span> columnIndex = (<span class="built_in">int</span>) args[<span class="number">1</span>];</span><br><span class="line">        WElement element = args[<span class="number">2</span>] <span class="keyword">as</span> WElement;</span><br><span class="line">        <span class="keyword">if</span> (element == <span class="literal">null</span>)</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        Text tText = element.GetComponent&lt;Text&gt;();</span><br><span class="line">        <span class="keyword">if</span> (tText == <span class="literal">null</span>)</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        tText.color = Color.black;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (messageType == WEventType.SELECT_ROW)</span><br><span class="line">    {</span><br><span class="line">        <span class="built_in">int</span> rowIndex = (<span class="built_in">int</span>) args[<span class="number">0</span>];</span><br><span class="line">        m_tempSelectIndex = rowIndex;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<h6 id="（5）为表项内容赋值"><a href="#（5）为表项内容赋值" class="headerlink" title="（5）为表项内容赋值"></a>（5）为表项内容赋值</h6><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> List&lt;<span class="built_in">object</span>&gt; <span class="title">GetRandomData</span>(<span class="params"><span class="built_in">int</span> i </span>)</span></span><br><span class="line">{</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> List&lt;<span class="built_in">object</span>&gt;</span><br><span class="line">    {</span><br><span class="line">       <span class="comment">// "浮木",</span></span><br><span class="line">       <span class="comment">// "杨本芬",</span></span><br><span class="line">       <span class="comment">//"四川人民出版社",</span></span><br><span class="line">       <span class="comment">// "2018-12",</span></span><br><span class="line">       <span class="comment">// "无",</span></span><br><span class="line">       <span class="comment">// 8.0 + i,</span></span><br><span class="line">       <span class="comment">// "未借出"</span></span><br><span class="line">       stars[i * <span class="number">7</span>].ToString(),</span><br><span class="line">       stars[i * <span class="number">7</span> + <span class="number">1</span>].ToString(),</span><br><span class="line">       stars[i * <span class="number">7</span> + <span class="number">2</span>].ToString(),</span><br><span class="line">       stars[i * <span class="number">7</span> + <span class="number">3</span>].ToString(),</span><br><span class="line">       stars[i * <span class="number">7</span> + <span class="number">4</span>].ToString(),</span><br><span class="line">       stars[i * <span class="number">7</span> + <span class="number">5</span>].ToString(),</span><br><span class="line">       stars[i * <span class="number">7</span> + <span class="number">6</span>].ToString()</span><br><span class="line">    };</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<p>同理，创建 Aexample.cs 为 “作者信息表” 进行创建及更新</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System.Collections;</span><br><span class="line"><span class="keyword">using</span> System.Collections.Generic;</span><br><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"><span class="keyword">using</span> UnityEngine.UI;</span><br><span class="line"><span class="keyword">using</span> WDT;</span><br><span class="line"><span class="keyword">using</span> System.Data;</span><br><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Aexample</span> : <span class="title">MonoBehaviour</span></span><br><span class="line">{</span><br><span class="line">    <span class="keyword">public</span> WDataTable dataTable;</span><br><span class="line">    <span class="keyword">private</span> List&lt;IList&lt;<span class="built_in">object</span>&gt;&gt; m_datas = <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">private</span> List&lt;WColumnDef&gt; m_columnDefs = <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">int</span> m_tempSelectIndex = <span class="number">-1</span>;</span><br><span class="line">    ArrayList stars = <span class="keyword">new</span> ArrayList();</span><br><span class="line">    <span class="built_in">int</span> row_n;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Start</span>()</span></span><br><span class="line">    {</span><br><span class="line">        SqlAccess sql = <span class="keyword">new</span> SqlAccess();</span><br><span class="line">        <span class="built_in">string</span>[] items = { <span class="string">"*"</span> };</span><br><span class="line">        <span class="built_in">string</span> tablename = <span class="string">"auther"</span>;</span><br><span class="line">        <span class="built_in">string</span> bookname = <span class="literal">null</span>;</span><br><span class="line">        DataSet ds = sql.SelectWhere(tablename, items, bookname);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (ds != <span class="literal">null</span>)</span><br><span class="line">        {</span><br><span class="line">            DataTable table = ds.Tables[<span class="number">0</span>];</span><br><span class="line">            <span class="keyword">foreach</span> (DataRow row <span class="keyword">in</span> table.Rows)</span><br><span class="line">            {</span><br><span class="line">                <span class="comment">// string str = "";</span></span><br><span class="line">                <span class="keyword">foreach</span> (DataColumn column <span class="keyword">in</span> table.Columns)</span><br><span class="line">                {</span><br><span class="line">                    <span class="built_in">string</span> str = <span class="string">""</span>;</span><br><span class="line">                    str += row[column];</span><br><span class="line">                    stars.Add(str);</span><br><span class="line">                }</span><br><span class="line">                <span class="comment">// Debug.Log(str + "ee");</span></span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">        Debug.Log(<span class="string">"changdu:"</span> + stars.Count);</span><br><span class="line">        row_n = stars.Count / <span class="number">5</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">//table.onClick.AddListener(gengxin);</span></span><br><span class="line"></span><br><span class="line">        m_datas = <span class="keyword">new</span> List&lt;IList&lt;<span class="built_in">object</span>&gt;&gt;();</span><br><span class="line">        <span class="comment">// name is necessary in columnDefs</span></span><br><span class="line">        m_columnDefs = <span class="keyword">new</span> List&lt;WColumnDef&gt;</span><br><span class="line">        {</span><br><span class="line">            <span class="keyword">new</span> WColumnDef() {name = <span class="string">"作者名"</span>},</span><br><span class="line">            <span class="keyword">new</span> WColumnDef() {name = <span class="string">"性别"</span>,width = <span class="string">"100"</span>},</span><br><span class="line">            <span class="keyword">new</span> WColumnDef() {name = <span class="string">"出生时间"</span>},</span><br><span class="line">            <span class="keyword">new</span> WColumnDef() {name = <span class="string">"出生地"</span>},</span><br><span class="line">            <span class="keyword">new</span> WColumnDef() {name = <span class="string">"国家"</span>,width = <span class="string">"200"</span>},</span><br><span class="line">            <span class="comment">//new WColumnDef() {name = "译者", width = "50%", disableSort = true}</span></span><br><span class="line"></span><br><span class="line">        };</span><br><span class="line">        <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; row_n; i++)</span><br><span class="line">        {</span><br><span class="line">            m_datas.Add(GetRandomData(i));</span><br><span class="line">        }</span><br><span class="line">        dataTable.msgHandle += HandleTableEvent;</span><br><span class="line">        dataTable.InitDataTable(m_datas, m_columnDefs);</span><br><span class="line"></span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">HandleTableEvent</span>(<span class="params">WEventType messageType, <span class="keyword">params</span> <span class="built_in">object</span>[] args</span>)</span></span><br><span class="line">    {</span><br><span class="line">        <span class="keyword">if</span> (messageType == WEventType.INIT_ELEMENT)</span><br><span class="line">        {</span><br><span class="line">            <span class="built_in">int</span> rowIndex = (<span class="built_in">int</span>)args[<span class="number">0</span>];</span><br><span class="line">            <span class="built_in">int</span> columnIndex = (<span class="built_in">int</span>)args[<span class="number">1</span>];</span><br><span class="line">            WElement element = args[<span class="number">2</span>] <span class="keyword">as</span> WElement;</span><br><span class="line">            <span class="keyword">if</span> (element == <span class="literal">null</span>)</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            Text tText = element.GetComponent&lt;Text&gt;();</span><br><span class="line">            <span class="keyword">if</span> (tText == <span class="literal">null</span>)</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            tText.color = Color.black;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (messageType == WEventType.SELECT_ROW)</span><br><span class="line">        {</span><br><span class="line">            <span class="built_in">int</span> rowIndex = (<span class="built_in">int</span>)args[<span class="number">0</span>];</span><br><span class="line">            m_tempSelectIndex = rowIndex;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="function"><span class="keyword">private</span> List&lt;<span class="built_in">object</span>&gt; <span class="title">GetRandomData</span>(<span class="params"><span class="built_in">int</span> i</span>)</span></span><br><span class="line">    {</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> List&lt;<span class="built_in">object</span>&gt;</span><br><span class="line">        {</span><br><span class="line">           stars[i * <span class="number">5</span>].ToString(),</span><br><span class="line">           stars[i * <span class="number">5</span> + <span class="number">1</span>].ToString(),</span><br><span class="line">           stars[i * <span class="number">5</span> + <span class="number">2</span>].ToString(),</span><br><span class="line">           stars[i * <span class="number">5</span> + <span class="number">3</span>].ToString(),</span><br><span class="line">           stars[i * <span class="number">5</span> + <span class="number">4</span>].ToString(),</span><br><span class="line">        };</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<p>同理，创建 Bexample.cs 为 “学生信息表” 进行创建及更新</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System.Collections;</span><br><span class="line"><span class="keyword">using</span> System.Collections.Generic;</span><br><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"><span class="keyword">using</span> UnityEngine.UI;</span><br><span class="line"><span class="keyword">using</span> WDT;</span><br><span class="line"><span class="keyword">using</span> System.Data;</span><br><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Bexample</span> : <span class="title">MonoBehaviour</span></span><br><span class="line">{</span><br><span class="line">    <span class="keyword">public</span> WDataTable dataTable;</span><br><span class="line">    <span class="keyword">private</span> List&lt;IList&lt;<span class="built_in">object</span>&gt;&gt; m_datas = <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">private</span> List&lt;WColumnDef&gt; m_columnDefs = <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">int</span> m_tempSelectIndex = <span class="number">-1</span>;</span><br><span class="line">    ArrayList stars = <span class="keyword">new</span> ArrayList();</span><br><span class="line">    <span class="built_in">int</span> row_n;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Start</span>()</span></span><br><span class="line">    {</span><br><span class="line">        SqlAccess sql = <span class="keyword">new</span> SqlAccess();</span><br><span class="line">        <span class="built_in">string</span>[] items = { <span class="string">"*"</span> };</span><br><span class="line">        <span class="built_in">string</span> tablename = <span class="string">"student"</span>;</span><br><span class="line">        <span class="built_in">string</span> bookname = <span class="literal">null</span>;</span><br><span class="line">        DataSet ds = sql.SelectWhere(tablename, items, bookname);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (ds != <span class="literal">null</span>)</span><br><span class="line">        {</span><br><span class="line">            DataTable table = ds.Tables[<span class="number">0</span>];</span><br><span class="line">            <span class="keyword">foreach</span> (DataRow row <span class="keyword">in</span> table.Rows)</span><br><span class="line">            {</span><br><span class="line">                <span class="comment">// string str = "";</span></span><br><span class="line">                <span class="keyword">foreach</span> (DataColumn column <span class="keyword">in</span> table.Columns)</span><br><span class="line">                {</span><br><span class="line">                    <span class="built_in">string</span> str = <span class="string">""</span>;</span><br><span class="line">                    str += row[column];</span><br><span class="line">                    stars.Add(str);</span><br><span class="line">                }</span><br><span class="line">                <span class="comment">// Debug.Log(str + "ee");</span></span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">        Debug.Log(<span class="string">"changdu:"</span> + stars.Count);</span><br><span class="line">        row_n = stars.Count / <span class="number">5</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">//table.onClick.AddListener(gengxin);</span></span><br><span class="line"></span><br><span class="line">        m_datas = <span class="keyword">new</span> List&lt;IList&lt;<span class="built_in">object</span>&gt;&gt;();</span><br><span class="line">        <span class="comment">// name is necessary in columnDefs</span></span><br><span class="line">        m_columnDefs = <span class="keyword">new</span> List&lt;WColumnDef&gt;</span><br><span class="line">        {</span><br><span class="line">            <span class="keyword">new</span> WColumnDef() {name = <span class="string">"姓名"</span>},</span><br><span class="line">            <span class="keyword">new</span> WColumnDef() {name = <span class="string">"学号"</span>},</span><br><span class="line">            <span class="keyword">new</span> WColumnDef() {name = <span class="string">"性别"</span>},</span><br><span class="line">            <span class="keyword">new</span> WColumnDef() {name = <span class="string">"院系"</span>},</span><br><span class="line">            <span class="keyword">new</span> WColumnDef() {name = <span class="string">"借阅书籍"</span>},</span><br><span class="line">            <span class="comment">//new WColumnDef() {name = "译者", width = "50%", disableSort = true}</span></span><br><span class="line"></span><br><span class="line">        };</span><br><span class="line">        <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; row_n; i++)</span><br><span class="line">        {</span><br><span class="line">            m_datas.Add(GetRandomData(i));</span><br><span class="line">        }</span><br><span class="line">        dataTable.msgHandle += HandleTableEvent;</span><br><span class="line">        dataTable.InitDataTable(m_datas, m_columnDefs);</span><br><span class="line"></span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">HandleTableEvent</span>(<span class="params">WEventType messageType, <span class="keyword">params</span> <span class="built_in">object</span>[] args</span>)</span></span><br><span class="line">    {</span><br><span class="line">        <span class="keyword">if</span> (messageType == WEventType.INIT_ELEMENT)</span><br><span class="line">        {</span><br><span class="line">            <span class="built_in">int</span> rowIndex = (<span class="built_in">int</span>)args[<span class="number">0</span>];</span><br><span class="line">            <span class="built_in">int</span> columnIndex = (<span class="built_in">int</span>)args[<span class="number">1</span>];</span><br><span class="line">            WElement element = args[<span class="number">2</span>] <span class="keyword">as</span> WElement;</span><br><span class="line">            <span class="keyword">if</span> (element == <span class="literal">null</span>)</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            Text tText = element.GetComponent&lt;Text&gt;();</span><br><span class="line">            <span class="keyword">if</span> (tText == <span class="literal">null</span>)</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            tText.color = Color.black;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (messageType == WEventType.SELECT_ROW)</span><br><span class="line">        {</span><br><span class="line">            <span class="built_in">int</span> rowIndex = (<span class="built_in">int</span>)args[<span class="number">0</span>];</span><br><span class="line">            m_tempSelectIndex = rowIndex;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="function"><span class="keyword">private</span> List&lt;<span class="built_in">object</span>&gt; <span class="title">GetRandomData</span>(<span class="params"><span class="built_in">int</span> i</span>)</span></span><br><span class="line">    {</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> List&lt;<span class="built_in">object</span>&gt;</span><br><span class="line">        {</span><br><span class="line"></span><br><span class="line">           stars[i * <span class="number">5</span>].ToString(),</span><br><span class="line">           stars[i * <span class="number">5</span> + <span class="number">1</span>].ToString(),</span><br><span class="line">           stars[i * <span class="number">5</span> + <span class="number">2</span>].ToString(),</span><br><span class="line">           stars[i * <span class="number">5</span> + <span class="number">3</span>].ToString(),</span><br><span class="line">           stars[i * <span class="number">5</span> + <span class="number">4</span>].ToString(),</span><br><span class="line">        };</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<p>DataTable.cs 脚本实现对表格内容进行动态更新和排序功能</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"><span class="keyword">using</span> System.Collections.Generic;</span><br><span class="line"><span class="keyword">using</span> System.Linq;</span><br><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"><span class="keyword">using</span> UnityEngine.Assertions;</span><br><span class="line"><span class="keyword">using</span> UnityEngine.UI;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">WDT</span></span><br><span class="line">{</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">enum</span> WEventType</span><br><span class="line">    {</span><br><span class="line">        SELECT_ROW,</span><br><span class="line">        SELECT_COLUMN,</span><br><span class="line">        SORT_BY_COLUMN,</span><br><span class="line">        INIT_ELEMENT,</span><br><span class="line">        EVENT_COUNT,</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">WColumnDef</span></span><br><span class="line">    {</span><br><span class="line">        <span class="keyword">public</span> <span class="built_in">string</span> name;</span><br><span class="line">        <span class="keyword">public</span> <span class="built_in">string</span> headPrefabName;</span><br><span class="line">        <span class="keyword">public</span> <span class="built_in">string</span> elementPrefabName;</span><br><span class="line">        <span class="keyword">public</span> <span class="built_in">string</span> width;</span><br><span class="line">        <span class="keyword">public</span> <span class="built_in">bool</span> disableSort;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="built_in">delegate</span> <span class="keyword">void</span> <span class="title">WMsgHandle</span>(<span class="params">WEventType messageType, <span class="keyword">params</span> <span class="built_in">object</span>[] args</span>)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">WDataTable</span> : <span class="title">MonoBehaviour</span></span><br><span class="line">    {</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">RowElementInfo</span></span><br><span class="line">        {</span><br><span class="line">            <span class="keyword">public</span> <span class="built_in">int</span> rowIndex;</span><br><span class="line">            <span class="keyword">public</span> WDataTable bindDataTable;</span><br><span class="line">            <span class="keyword">public</span> IList&lt;WColumnDef&gt; columnsDefs;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">class</span> <span class="title">SortItem</span></span><br><span class="line">        {</span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="title">SortItem</span>(<span class="params"><span class="built_in">int</span> indexIn, <span class="built_in">object</span> itemIn</span>)</span></span><br><span class="line">            {</span><br><span class="line">                rowIndex = indexIn;</span><br><span class="line">                item = itemIn;</span><br><span class="line">            }</span><br><span class="line"></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">readonly</span> <span class="built_in">int</span> rowIndex;</span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">readonly</span> <span class="built_in">object</span> item;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        [<span class="meta">HideInInspector</span>] <span class="keyword">public</span> WMsgHandle msgHandle;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="built_in">string</span> rowPrefab;</span><br><span class="line">        <span class="keyword">public</span> <span class="built_in">string</span> defaultHeadPrefabName;</span><br><span class="line">        <span class="keyword">public</span> <span class="built_in">string</span> defaultElementPrefabName;</span><br><span class="line">        <span class="keyword">public</span> <span class="built_in">int</span> itemHeight;</span><br><span class="line">        <span class="keyword">public</span> <span class="built_in">int</span> tableWidth;</span><br><span class="line">        <span class="keyword">public</span> <span class="built_in">int</span> tableHeight;</span><br><span class="line">        <span class="keyword">public</span> <span class="built_in">bool</span> isUseSort = <span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="built_in">bool</span> isUseSelect = <span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">private</span> <span class="built_in">bool</span> m_init;</span><br><span class="line">        <span class="keyword">private</span> WHead m_head;</span><br><span class="line">        <span class="keyword">private</span> LoopVerticalScrollRect m_scrollRect;</span><br><span class="line">        <span class="keyword">private</span> RectTransform m_scrollRectTransform;</span><br><span class="line">        <span class="keyword">private</span> RectTransform m_scrollbarRectTransform;</span><br><span class="line">        <span class="keyword">private</span> IList&lt;IList&lt;<span class="built_in">object</span>&gt;&gt; m_datas = <span class="keyword">new</span> List&lt;IList&lt;<span class="built_in">object</span>&gt;&gt;();</span><br><span class="line">        <span class="keyword">private</span> IList&lt;WColumnDef&gt; m_columnDefs = <span class="keyword">new</span> List&lt;WColumnDef&gt;();</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">readonly</span> IList&lt;RowElementInfo&gt; m_rowInfos = <span class="keyword">new</span> List&lt;RowElementInfo&gt;();</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">readonly</span> IList&lt;<span class="built_in">int</span>&gt; m_columnWidths = <span class="keyword">new</span> List&lt;<span class="built_in">int</span>&gt;();</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">readonly</span> List&lt;SortItem&gt; m_sortItems = <span class="keyword">new</span> List&lt;SortItem&gt;();</span><br><span class="line"></span><br><span class="line">        <span class="meta">#<span class="keyword">region</span> public</span></span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> LoopVerticalScrollRect <span class="title">GetLoopScrollRect</span>()</span></span><br><span class="line">        {</span><br><span class="line">            <span class="keyword">return</span> m_scrollRect;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="built_in">float</span> <span class="title">GetPositionByNewSize</span>(<span class="params"><span class="built_in">float</span> oldPosition, <span class="built_in">int</span> oldCount, <span class="built_in">int</span> newCount</span>)</span></span><br><span class="line">        {</span><br><span class="line">            <span class="built_in">float</span> offset = oldPosition * (itemHeight * oldCount - tableHeight);</span><br><span class="line">            <span class="built_in">float</span> newPosition = offset / (itemHeight * newCount - tableHeight);</span><br><span class="line">            <span class="keyword">return</span> newPosition;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="built_in">float</span> <span class="title">GetPosition</span>()</span></span><br><span class="line">        {</span><br><span class="line">            <span class="keyword">if</span> (m_scrollRect == <span class="literal">null</span>)</span><br><span class="line">                <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> m_scrollRect.verticalNormalizedPosition;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">SetPosition</span>(<span class="params"><span class="built_in">float</span> position</span>)</span></span><br><span class="line">        {</span><br><span class="line">            <span class="keyword">if</span> (m_scrollRect == <span class="literal">null</span>)</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">            m_scrollRect.verticalNormalizedPosition = position;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> Sorts the index of the by.</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name="columnIndex"&gt;</span>The index.<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">SortByIndex</span>(<span class="params"><span class="built_in">int</span> columnIndex</span>)</span></span><br><span class="line">        {</span><br><span class="line">            <span class="keyword">if</span> (columnIndex &lt; <span class="number">0</span> || columnIndex &gt;= m_columnDefs.Count)</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (m_rowInfos.Count == <span class="number">0</span> || !(m_datas[<span class="number">0</span>][columnIndex] <span class="keyword">is</span> IComparable))</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">            m_sortItems.Clear();</span><br><span class="line">            <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; m_datas.Count; i++)</span><br><span class="line">                m_sortItems.Add(<span class="keyword">new</span> SortItem(i, m_datas[i][columnIndex]));</span><br><span class="line"></span><br><span class="line">            m_sortItems.Sort((x, y) =&gt;</span><br><span class="line">            {</span><br><span class="line">                <span class="keyword">var</span> cpX = x.item <span class="keyword">as</span> IComparable;</span><br><span class="line">                <span class="keyword">var</span> cpY = y.item <span class="keyword">as</span> IComparable;</span><br><span class="line">                <span class="keyword">if</span> (cpX == <span class="literal">null</span> || cpY == <span class="literal">null</span>)</span><br><span class="line">                    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">                <span class="keyword">return</span> cpX.CompareTo(cpY);</span><br><span class="line">            });</span><br><span class="line"></span><br><span class="line">            <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; m_sortItems.Count; i++)</span><br><span class="line">                m_rowInfos[i].rowIndex = m_sortItems[i].rowIndex;</span><br><span class="line"></span><br><span class="line">            UpdateByRowInfo();</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (msgHandle != <span class="literal">null</span>)</span><br><span class="line">                msgHandle(WEventType.SORT_BY_COLUMN, columnIndex);</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> update data of the data table. need ensure right data</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name="datas"&gt;</span>The datas.<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">UpdateData</span>(<span class="params">IList&lt;IList&lt;<span class="built_in">object</span>&gt;&gt; datas</span>)</span></span><br><span class="line">        {</span><br><span class="line">            <span class="keyword">if</span> (datas == <span class="literal">null</span>)</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (!m_init)</span><br><span class="line">            {</span><br><span class="line">                Debug.LogError(<span class="string">"not init data table"</span>);</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            }</span><br><span class="line"></span><br><span class="line">            IList&lt;IList&lt;<span class="built_in">object</span>&gt;&gt; tDatas = datas;</span><br><span class="line">            <span class="keyword">if</span> (!CheckInputData(tDatas, m_columnDefs))</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (!CheckConfig())</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">            m_datas = datas;</span><br><span class="line">            m_rowInfos.Clear();</span><br><span class="line">            <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; m_datas.Count; i++)</span><br><span class="line">                m_rowInfos.Add(<span class="keyword">new</span> RowElementInfo {rowIndex = i, bindDataTable = <span class="keyword">this</span>, columnsDefs = m_columnDefs});</span><br><span class="line"></span><br><span class="line">            UpdateByRowInfo();</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> Initializes the data table. need ensure right data</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name="datas"&gt;</span>The datas.<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name="columnDefs"&gt;</span><span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">InitDataTable</span>(<span class="params">IList&lt;IList&lt;<span class="built_in">object</span>&gt;&gt; datas, IList&lt;WColumnDef&gt; columnDefs</span>)</span></span><br><span class="line">        {</span><br><span class="line">            <span class="keyword">if</span> (!CheckInputData(datas, columnDefs))</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (!CheckConfig())</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (!m_init)</span><br><span class="line">                Init();</span><br><span class="line"></span><br><span class="line">            <span class="comment">// copy</span></span><br><span class="line">            m_datas = datas;</span><br><span class="line">            m_columnDefs = columnDefs;</span><br><span class="line">            m_rowInfos.Clear();</span><br><span class="line">            <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; m_datas.Count; i++)</span><br><span class="line">                m_rowInfos.Add(<span class="keyword">new</span> RowElementInfo {rowIndex = i, bindDataTable = <span class="keyword">this</span>, columnsDefs = m_columnDefs});</span><br><span class="line"></span><br><span class="line">            UpdateColumnWidths();</span><br><span class="line">            m_head.SetColumnInfo(m_columnDefs, <span class="keyword">this</span>);</span><br><span class="line">            m_scrollRect.prefabSource.prefabName = rowPrefab;</span><br><span class="line">            UpdateScrollRectSize();</span><br><span class="line">            UpdateByRowInfo();</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> IList&lt;<span class="built_in">object</span>&gt; <span class="title">GetInfosByRowIndex</span>(<span class="params"><span class="built_in">int</span> rowIndex</span>)</span></span><br><span class="line">        {</span><br><span class="line">            <span class="keyword">if</span> (rowIndex &lt; <span class="number">0</span> || rowIndex &gt;= m_datas.Count)</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> m_datas[rowIndex];</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">OnClickRow</span>(<span class="params"><span class="built_in">int</span> rowIndex</span>)</span></span><br><span class="line">        {</span><br><span class="line">            Debug.Log(<span class="string">"clicked rowIndex"</span> + rowIndex);</span><br><span class="line">            <span class="keyword">if</span> (msgHandle != <span class="literal">null</span>)</span><br><span class="line">                msgHandle(WEventType.SELECT_ROW, rowIndex);</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">OnClickColumn</span>(<span class="params"><span class="built_in">int</span> columnIndex</span>)</span></span><br><span class="line">        {</span><br><span class="line">            <span class="keyword">if</span> (isUseSort)</span><br><span class="line">                SortByIndex(columnIndex);</span><br><span class="line"></span><br><span class="line">            Debug.Log(<span class="string">"clicked columnIndex "</span> + columnIndex);</span><br><span class="line">            <span class="keyword">if</span> (msgHandle != <span class="literal">null</span>)</span><br><span class="line">                msgHandle(WEventType.SELECT_COLUMN, columnIndex);</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">OnClickButton</span>(<span class="params"><span class="built_in">int</span> rowIndex, <span class="built_in">int</span> columnIndex</span>)</span></span><br><span class="line">        {</span><br><span class="line">            Debug.Log(<span class="string">"clicked button row "</span> + rowIndex + <span class="string">" columnIndex "</span> + columnIndex);</span><br><span class="line">            <span class="keyword">if</span> (rowIndex == <span class="number">-1</span>)</span><br><span class="line">                OnClickColumn(columnIndex);</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">OnInitElement</span>(<span class="params"><span class="built_in">int</span> rowIndex, <span class="built_in">int</span> columnIndex, WElement element</span>)</span></span><br><span class="line">        {</span><br><span class="line">            <span class="keyword">if</span> (msgHandle != <span class="literal">null</span>)</span><br><span class="line">                msgHandle(WEventType.INIT_ELEMENT, rowIndex, columnIndex, element);</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        [<span class="meta">ContextMenu(<span class="string">"UpdateSize"</span>)</span>]</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">UpdateSize</span>()</span></span><br><span class="line">        {</span><br><span class="line">            <span class="keyword">if</span> (!m_init)</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">            UpdateColumnWidths();</span><br><span class="line">            m_head.UpdateHeadSize();</span><br><span class="line">            UpdateScrollRectSize();</span><br><span class="line">            m_scrollRect.RefillCells();</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="built_in">int</span> <span class="title">GetWidthByColumnIndex</span>(<span class="params"><span class="built_in">int</span> columnIndex</span>)</span></span><br><span class="line">        {</span><br><span class="line">            <span class="keyword">if</span> (columnIndex &lt; <span class="number">0</span> || columnIndex &gt;= m_columnWidths.Count)</span><br><span class="line">                <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">return</span> m_columnWidths[columnIndex];</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="built_in">bool</span> <span class="title">CanSortByColumnIndex</span>(<span class="params"><span class="built_in">int</span> columnIndex</span>)</span></span><br><span class="line">        {</span><br><span class="line">            <span class="keyword">if</span> (m_columnDefs == <span class="literal">null</span>)</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (columnIndex &lt; <span class="number">0</span> || columnIndex &gt;= m_columnDefs.Count)</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (m_columnDefs[columnIndex] == <span class="literal">null</span>)</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> !m_columnDefs[columnIndex].disableSort;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="meta">#<span class="keyword">endregion</span></span></span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">Init</span>()</span></span><br><span class="line">        {</span><br><span class="line">            m_scrollRect = GetComponentInChildren&lt;LoopVerticalScrollRect&gt;();</span><br><span class="line">            m_head = GetComponentInChildren&lt;WHead&gt;();</span><br><span class="line">            Assert.IsNotNull(m_scrollRect);</span><br><span class="line">            Assert.IsNotNull(m_head);</span><br><span class="line">            m_scrollRectTransform = m_scrollRect.GetComponent&lt;RectTransform&gt;();</span><br><span class="line">            m_scrollbarRectTransform = m_scrollRect.verticalScrollbar.GetComponent&lt;RectTransform&gt;();</span><br><span class="line">            Assert.IsNotNull(m_scrollRectTransform);</span><br><span class="line">            Assert.IsNotNull(m_scrollbarRectTransform);</span><br><span class="line">            m_init = <span class="literal">true</span>;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">UpdateColumnWidths</span>()</span></span><br><span class="line">        {</span><br><span class="line">            <span class="keyword">if</span> (m_columnDefs == <span class="literal">null</span>)</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">            m_columnWidths.Clear();</span><br><span class="line">            <span class="keyword">if</span> (m_columnDefs == <span class="literal">null</span> || m_columnDefs.Count == <span class="number">0</span>)</span><br><span class="line">            {</span><br><span class="line">                <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; m_columnDefs.Count; i++)</span><br><span class="line">                {</span><br><span class="line">                    m_columnWidths.Add(tableWidth / m_columnDefs.Count);</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">            {</span><br><span class="line">                <span class="built_in">int</span> totalWidth = <span class="number">0</span>;</span><br><span class="line">                <span class="built_in">int</span> totalCount = <span class="number">0</span>;</span><br><span class="line">                <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; m_columnDefs.Count; i++)</span><br><span class="line">                {</span><br><span class="line">                    <span class="built_in">int</span> width = <span class="number">0</span>;</span><br><span class="line">                    <span class="keyword">if</span> (m_columnDefs[i] != <span class="literal">null</span> &amp;&amp; !<span class="built_in">string</span>.IsNullOrEmpty(m_columnDefs[i].width))</span><br><span class="line">                    {</span><br><span class="line">                        <span class="keyword">if</span> (m_columnDefs[i].width.Contains(<span class="string">'%'</span>))</span><br><span class="line">                        {</span><br><span class="line">                            <span class="built_in">string</span> percentString = m_columnDefs[i].width.Replace(<span class="string">"%"</span>, <span class="string">""</span>);</span><br><span class="line">                            <span class="built_in">int</span> percent;</span><br><span class="line">                            <span class="built_in">int</span>.TryParse(percentString, <span class="keyword">out</span> percent);</span><br><span class="line">                            width = (<span class="built_in">int</span>) (tableWidth * (percent / <span class="number">100.0f</span>));</span><br><span class="line">                        }</span><br><span class="line">                        <span class="keyword">else</span></span><br><span class="line">                        {</span><br><span class="line">                            <span class="built_in">int</span>.TryParse(m_columnDefs[i].width, <span class="keyword">out</span> width);</span><br><span class="line">                        }</span><br><span class="line">                    }</span><br><span class="line"></span><br><span class="line">                    m_columnWidths.Add(width);</span><br><span class="line">                    <span class="keyword">if</span> (width &gt; <span class="number">0</span>)</span><br><span class="line">                    {</span><br><span class="line">                        totalCount += <span class="number">1</span>;</span><br><span class="line">                        totalWidth += width;</span><br><span class="line">                    }</span><br><span class="line">                }</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (totalCount &lt; m_columnDefs.Count)</span><br><span class="line">                {</span><br><span class="line">                    <span class="built_in">int</span> otherWidth = (tableWidth - totalWidth) / (m_columnDefs.Count - totalCount);</span><br><span class="line">                    <span class="keyword">if</span> (otherWidth &lt;= <span class="number">0</span>)</span><br><span class="line">                        Debug.LogError(<span class="string">"Error columnDef for calculate column width"</span>);</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; m_columnWidths.Count; i++)</span><br><span class="line">                    {</span><br><span class="line">                        <span class="keyword">if</span> (m_columnWidths[i] == <span class="number">0</span>)</span><br><span class="line">                            m_columnWidths[i] = otherWidth;</span><br><span class="line">                    }</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">UpdateScrollRectSize</span>()</span></span><br><span class="line">        {</span><br><span class="line">            m_scrollRectTransform.sizeDelta = <span class="keyword">new</span> Vector2(tableWidth, tableHeight);</span><br><span class="line">            m_scrollbarRectTransform.anchoredPosition = <span class="keyword">new</span> Vector2(tableWidth, <span class="number">0</span>);</span><br><span class="line">            m_scrollbarRectTransform.sizeDelta = <span class="keyword">new</span> Vector2(<span class="number">20</span>, tableHeight);</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">UpdateByRowInfo</span>()</span></span><br><span class="line">        {</span><br><span class="line">            m_scrollRect.objectsToFill = m_rowInfos.ToArray();</span><br><span class="line">            m_scrollRect.totalCount = m_rowInfos.Count;</span><br><span class="line">            m_scrollRect.RefillCells();</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">private</span> <span class="built_in">bool</span> <span class="title">CheckConfig</span>()</span></span><br><span class="line">        {</span><br><span class="line">            <span class="keyword">if</span> (<span class="built_in">string</span>.IsNullOrEmpty(rowPrefab))</span><br><span class="line">            {</span><br><span class="line">                Debug.LogError(<span class="string">"need set rowPrefab name"</span>);</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            }</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (itemHeight &lt;= <span class="number">0</span> || tableWidth &lt;= <span class="number">0</span> || tableHeight &lt;= <span class="number">0</span>)</span><br><span class="line">            {</span><br><span class="line">                Debug.LogError(<span class="string">"size number greater than zero"</span>);</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            }</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (itemHeight &gt; tableHeight)</span><br><span class="line">            {</span><br><span class="line">                Debug.LogError(<span class="string">"need itemHeight &lt; tableHeight"</span>);</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            }</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">private</span> <span class="built_in">bool</span> <span class="title">CheckInputData</span>(<span class="params">IList&lt;IList&lt;<span class="built_in">object</span>&gt;&gt; datas, ICollection&lt;WColumnDef&gt; columnDefs</span>)</span></span><br><span class="line">        {</span><br><span class="line">            <span class="keyword">if</span> (datas == <span class="literal">null</span> || columnDefs == <span class="literal">null</span>)</span><br><span class="line">            {</span><br><span class="line">                Debug.LogError(<span class="string">"datas columnDefs not be null"</span>);</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            }</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (datas.Count == <span class="number">0</span>)</span><br><span class="line">            {</span><br><span class="line">                Debug.LogError(<span class="string">"empty data"</span>);</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            }</span><br><span class="line"></span><br><span class="line">            <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; datas.Count; i++)</span><br><span class="line">            {</span><br><span class="line">                <span class="keyword">if</span> (datas[i].Count != columnDefs.Count)</span><br><span class="line">                {</span><br><span class="line">                    Debug.LogError(<span class="string">"row data length not equal columns length:"</span> + i);</span><br><span class="line">                    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line"></span><br><span class="line">            <span class="keyword">foreach</span> (<span class="keyword">var</span> column <span class="keyword">in</span> columnDefs)</span><br><span class="line">            {</span><br><span class="line">                <span class="keyword">if</span> (<span class="built_in">string</span>.IsNullOrEmpty(column.name))</span><br><span class="line">                {</span><br><span class="line">                    Debug.LogError(<span class="string">"columnDefs need contain column name"</span>);</span><br><span class="line">                    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">                }</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (<span class="built_in">string</span>.IsNullOrEmpty(defaultHeadPrefabName) &amp;&amp; <span class="built_in">string</span>.IsNullOrEmpty(column.headPrefabName))</span><br><span class="line">                {</span><br><span class="line">                    Debug.LogError(<span class="string">"if defaultHeadPrefabName is empty, columnDefs need contain headPrefabName"</span>);</span><br><span class="line">                    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">                }</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (<span class="built_in">string</span>.IsNullOrEmpty(defaultElementPrefabName) &amp;&amp; <span class="built_in">string</span>.IsNullOrEmpty(column.elementPrefabName))</span><br><span class="line">                {</span><br><span class="line">                    Debug.LogError(<span class="string">"if defaultElementPrefabName is empty, columnDefs need contain elementPrefabName"</span>);</span><br><span class="line">                    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line"></span><br><span class="line">            <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; columnDefs.Count; i++)</span><br><span class="line">            {</span><br><span class="line">                <span class="keyword">for</span> (<span class="built_in">int</span> j = <span class="number">0</span>; j &lt; datas.Count - <span class="number">1</span>; j++)</span><br><span class="line">                {</span><br><span class="line">                    <span class="keyword">if</span> ((datas[j][i] == <span class="literal">null</span>) || (datas[j + <span class="number">1</span>][i] == <span class="literal">null</span>))</span><br><span class="line">                    {</span><br><span class="line">                        <span class="keyword">if</span> ((datas[j][i] == <span class="literal">null</span>) &amp;&amp; (datas[j + <span class="number">1</span>][i] == <span class="literal">null</span>))</span><br><span class="line">                            <span class="keyword">continue</span>;</span><br><span class="line"></span><br><span class="line">                        Debug.LogError(<span class="string">"data type not same:["</span> + j + <span class="string">","</span> + i + <span class="string">"], ["</span> + (j + <span class="number">1</span>) + <span class="string">","</span> + i + <span class="string">"]"</span>);</span><br><span class="line">                        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">                    }</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">if</span> (datas[j][i].GetType() == datas[j + <span class="number">1</span>][i].GetType())</span><br><span class="line">                        <span class="keyword">continue</span>;</span><br><span class="line"></span><br><span class="line">                    Debug.LogError(<span class="string">"data type not same:["</span> + j + <span class="string">","</span> + i + <span class="string">"], ["</span> + (j + <span class="number">1</span>) + <span class="string">","</span> + i + <span class="string">"]"</span>);</span><br><span class="line">                    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<h3 id="5、添加界面"><a href="#5、添加界面" class="headerlink" title="5、添加界面"></a>5、添加界面</h3><h4 id="Ⅰ、界面绘制及功能介绍-3"><a href="#Ⅰ、界面绘制及功能介绍-3" class="headerlink" title="Ⅰ、界面绘制及功能介绍"></a>Ⅰ、界面绘制及功能介绍</h4><p><img src="https://s2.loli.net/2022/07/26/A3fboNILyPs25lS.png" alt="image-20220628015334405"></p>
<p>该界面由 <strong>11个输入框组件</strong> 和 <strong>2个按钮组件</strong> 构成</p>
<p>用户通过在本界面输入相应的书籍或者作者信息，可以实现在数据库中添加记录的功能</p>
<p><strong>【例】</strong></p>
<p><img src="https://s2.loli.net/2022/07/26/3R4NMxCesDkpvIP.png" alt="image-20220628015724530"></p>
<p>注：书籍信息为个人编纂，仅测试用</p>
<p>若输入已有书籍，则会产生报错</p>
<p><img src="https://s2.loli.net/2022/07/26/vAiekpjGJZ35WlX.png" alt="image-20220628015833643"></p>
<h4 id="Ⅱ、功能实现-3"><a href="#Ⅱ、功能实现-3" class="headerlink" title="Ⅱ、功能实现"></a>Ⅱ、功能实现</h4><h5 id="（1）引入命名空间-3"><a href="#（1）引入命名空间-3" class="headerlink" title="（1）引入命名空间"></a>（1）引入命名空间</h5><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System.Collections;</span><br><span class="line"><span class="keyword">using</span> System.Collections.Generic;</span><br><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"><span class="keyword">using</span> UnityEngine.UI;</span><br><span class="line"><span class="keyword">using</span> System.Data;</span><br></pre></td></tr></table></figure>
<h5 id="（2）对变量及组件进行初始化赋值"><a href="#（2）对变量及组件进行初始化赋值" class="headerlink" title="（2）对变量及组件进行初始化赋值"></a>（2）对变量及组件进行初始化赋值</h5><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> InputField nameinput;</span><br><span class="line"><span class="keyword">public</span> InputField autherinput;</span><br><span class="line"><span class="keyword">public</span> InputField producerinput;</span><br><span class="line"><span class="keyword">public</span> InputField ageinput;</span><br><span class="line"><span class="keyword">public</span> InputField tanslaterinput;</span><br><span class="line"><span class="keyword">public</span> InputField starinput;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> InputField authernameinput;</span><br><span class="line"><span class="keyword">public</span> InputField authersexinput;</span><br><span class="line"><span class="keyword">public</span> InputField birthinput;</span><br><span class="line"><span class="keyword">public</span> InputField areainput;</span><br><span class="line"><span class="keyword">public</span> InputField countryinput;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> Button addbtn;</span><br><span class="line"><span class="keyword">public</span> Button addbtn1;</span><br><span class="line"><span class="keyword">public</span> GameObject shibai;</span><br><span class="line"><span class="keyword">public</span> GameObject chenggong;</span><br><span class="line">DataSet ds;</span><br></pre></td></tr></table></figure>
<h5 id="（3）对按钮事件进行绑定"><a href="#（3）对按钮事件进行绑定" class="headerlink" title="（3）对按钮事件进行绑定"></a>（3）对按钮事件进行绑定</h5><pre><code>private void Start()
{
    shibai.SetActive(false);
    chenggong.SetActive(false);
    addbtn.onClick.AddListener(Add);
    addbtn1.onClick.AddListener(Add1);
}
</code></pre><h5 id="（4）实现添加书籍信息的功能"><a href="#（4）实现添加书籍信息的功能" class="headerlink" title="（4）实现添加书籍信息的功能"></a>（4）实现添加书籍信息的功能</h5><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Add</span>()</span></span><br><span class="line">{</span><br><span class="line">    SqlAccess sql = <span class="keyword">new</span> SqlAccess();</span><br><span class="line">    <span class="built_in">string</span> tablename = <span class="string">"books"</span>;</span><br><span class="line">    <span class="built_in">string</span> bookname = nameinput.text;</span><br><span class="line">    <span class="built_in">string</span> auther = autherinput.text;</span><br><span class="line">    <span class="built_in">string</span> producer = producerinput.text;</span><br><span class="line">    <span class="built_in">string</span> age = ageinput.text;</span><br><span class="line">    <span class="built_in">string</span> translate = tanslaterinput.text;</span><br><span class="line">    <span class="built_in">string</span> star = starinput.text;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="built_in">string</span>[] datavalues = <span class="keyword">new</span> <span class="built_in">string</span>[] {bookname,auther,producer,age,translate,star,<span class="string">"未借出"</span>};</span><br><span class="line">    <span class="keyword">if</span>( bookname != <span class="string">""</span>)</span><br><span class="line">    {</span><br><span class="line">        ds = sql.Additem(tablename, datavalues);</span><br><span class="line">        chenggong.SetActive(<span class="literal">true</span>);</span><br><span class="line">    }</span><br><span class="line">         </span><br><span class="line">    <span class="keyword">if</span> (ds == <span class="literal">null</span>)</span><br><span class="line">    {</span><br><span class="line">        shibai.SetActive(<span class="literal">true</span>);</span><br><span class="line">    }        </span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<h5 id="（5）实现添加作者信息的功能"><a href="#（5）实现添加作者信息的功能" class="headerlink" title="（5）实现添加作者信息的功能"></a>（5）实现添加作者信息的功能</h5><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Add1</span>()</span></span><br><span class="line">{</span><br><span class="line">    SqlAccess sql = <span class="keyword">new</span> SqlAccess();</span><br><span class="line">    <span class="built_in">string</span> tablename = <span class="string">"auther"</span>;</span><br><span class="line">    <span class="built_in">string</span> authername = authernameinput.text;</span><br><span class="line">    <span class="built_in">string</span> authersex = authersexinput.text;</span><br><span class="line">    <span class="built_in">string</span> birth = birthinput.text;</span><br><span class="line">    <span class="built_in">string</span> area = areainput.text;</span><br><span class="line">    <span class="built_in">string</span> country = countryinput.text;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="built_in">string</span>[] datavalues = <span class="keyword">new</span> <span class="built_in">string</span>[] { authername, authersex, birth, area, country };</span><br><span class="line">    <span class="keyword">if</span> (authername != <span class="string">""</span>)</span><br><span class="line">    {</span><br><span class="line">        ds = sql.Additem(tablename, datavalues);</span><br><span class="line">        chenggong.SetActive(<span class="literal">true</span>);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (ds == <span class="literal">null</span>)</span><br><span class="line">    {</span><br><span class="line">        shibai.SetActive(<span class="literal">true</span>);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<h3 id="6、修改界面"><a href="#6、修改界面" class="headerlink" title="6、修改界面"></a>6、修改界面</h3><h4 id="Ⅰ、界面绘制及功能介绍-4"><a href="#Ⅰ、界面绘制及功能介绍-4" class="headerlink" title="Ⅰ、界面绘制及功能介绍"></a>Ⅰ、界面绘制及功能介绍</h4><p><img src="https://s2.loli.net/2022/07/26/zwWLVxNUorJm7Al.png" alt="image-20220628020246461"></p>
<p>用户通过输入书籍名称对要修改的书籍进行查找</p>
<p><img src="https://s2.loli.net/2022/07/26/njx3WSUELH7Vy8M.png" alt="image-20220628020338245"></p>
<p><img src="https://s2.loli.net/2022/07/26/IyBV9qJm7c68iRn.png" alt="image-20220628020355296"></p>
<p>查找完成后可以对书籍信息进行修改，修改完成后点击 <strong>修改</strong> 按钮</p>
<p><img src="https://s2.loli.net/2022/07/26/JbTUvKhPm1VwduO.png" alt="image-20220628020450178"></p>
<p>再点击确认，即可修改成功</p>
<p><img src="https://s2.loli.net/2022/07/26/gZfeSkWuIo1YdTO.png" alt="image-20220628020540363"></p>
<h4 id="Ⅱ、功能实现-4"><a href="#Ⅱ、功能实现-4" class="headerlink" title="Ⅱ、功能实现"></a>Ⅱ、功能实现</h4><p>创建 AlterCanvas.cs 脚本</p>
<h5 id="（1）引入命名空间-4"><a href="#（1）引入命名空间-4" class="headerlink" title="（1）引入命名空间"></a>（1）引入命名空间</h5><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System.Collections;</span><br><span class="line"><span class="keyword">using</span> System.Collections.Generic;</span><br><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"><span class="keyword">using</span> UnityEngine.UI;</span><br><span class="line"><span class="keyword">using</span> System.Data;</span><br><span class="line"><span class="keyword">using</span> System.Timers;</span><br></pre></td></tr></table></figure>
<h5 id="（2）变量及组件的初始化"><a href="#（2）变量及组件的初始化" class="headerlink" title="（2）变量及组件的初始化"></a>（2）变量及组件的初始化</h5><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> GameObject confcanvas;</span><br><span class="line"><span class="keyword">public</span> GameObject confcanvas1;</span><br><span class="line"><span class="keyword">public</span> InputField input_bookname;</span><br><span class="line"><span class="keyword">public</span> Text showtext;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> InputField nameinput;</span><br><span class="line"><span class="keyword">public</span> InputField autherinput;</span><br><span class="line"><span class="keyword">public</span> InputField producerinput;</span><br><span class="line"><span class="keyword">public</span> InputField ageinput;</span><br><span class="line"><span class="keyword">public</span> InputField tanslaterinput;</span><br><span class="line"><span class="keyword">public</span> InputField starinput;</span><br><span class="line"><span class="keyword">public</span> InputField borrowinput;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> Button querybtn;</span><br><span class="line"><span class="keyword">public</span> Button alterbtn;</span><br><span class="line"><span class="keyword">public</span> Button shanchubtn;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> Button quxiao_btn;</span><br><span class="line"><span class="keyword">public</span> Button queren_btn;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> Button quxiao_btn1;</span><br><span class="line"><span class="keyword">public</span> Button queren_btn1;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> Color colorOrgion = <span class="keyword">new</span> Color(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>);<span class="comment">//默认为黑色</span></span><br><span class="line"><span class="keyword">private</span> <span class="built_in">float</span> Alpha = <span class="number">1.0f</span>;</span><br><span class="line"><span class="keyword">private</span> <span class="built_in">bool</span> isbeclikck = <span class="literal">false</span>;</span><br><span class="line">Timer timer = <span class="keyword">new</span> Timer(<span class="number">2000</span>);<span class="comment">//延迟2秒</span></span><br></pre></td></tr></table></figure>
<h5 id="（3）组件绑定及变量初始化"><a href="#（3）组件绑定及变量初始化" class="headerlink" title="（3）组件绑定及变量初始化"></a>（3）组件绑定及变量初始化</h5><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Start</span>()</span></span><br><span class="line">{    </span><br><span class="line">    querybtn.onClick.AddListener(chaxun);</span><br><span class="line"></span><br><span class="line">    alterbtn.onClick.AddListener(xianshi);</span><br><span class="line">    quxiao_btn.onClick.AddListener(quxiao);</span><br><span class="line">    queren_btn.onClick.AddListener(queren);</span><br><span class="line"></span><br><span class="line">    shanchubtn.onClick.AddListener(xianshi1);</span><br><span class="line">    quxiao_btn1.onClick.AddListener(quxiao1);</span><br><span class="line">    queren_btn1.onClick.AddListener(queren1);</span><br><span class="line"></span><br><span class="line">    showtext.color = <span class="keyword">new</span> Color(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>);<span class="comment">//默认不显示</span></span><br><span class="line"></span><br><span class="line">    timer.Elapsed += (<span class="built_in">object</span> sender, ElapsedEventArgs e) =&gt;</span><br><span class="line">    {</span><br><span class="line">        isbeclikck = <span class="literal">true</span>;</span><br><span class="line">    };</span><br><span class="line"></span><br><span class="line">    timer.AutoReset = <span class="literal">false</span>; <span class="comment">//如果 System.Timers.Timer 应在每次间隔结束时引发 System.Timers.Timer.Elapsed 事件，则为 true；如果它仅在间隔第一次结束后引发一次，可以新建一颗控制台应用，然后F12跟进去查看详情，这是我复制粘贴的，</span></span><br><span class="line">    timer.Enabled = <span class="literal">true</span>;<span class="comment">// 如果 System.Timers.Timer 应引发 System.Timers.Timer.Elapsed 事件，则为 true；</span></span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<h5 id="（4）依次实现各个按钮的功能"><a href="#（4）依次实现各个按钮的功能" class="headerlink" title="（4）依次实现各个按钮的功能"></a>（4）依次实现各个按钮的功能</h5><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">Update</span>()</span></span><br><span class="line">{</span><br><span class="line">    <span class="keyword">if</span> (isbeclikck)</span><br><span class="line">    {</span><br><span class="line">        Alpha = Alpha - (Time.deltaTime);<span class="comment">//通过修改阿尔法值来设置显示或隐藏</span></span><br><span class="line">        colorOrgion.a = Alpha;</span><br><span class="line">        showtext.color = colorOrgion;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">if</span> (colorOrgion.a &lt;= <span class="number">0</span>)<span class="comment">//如果阿尔法小于0就代表文字完全消失了</span></span><br><span class="line">    {</span><br><span class="line">        isbeclikck = <span class="literal">false</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">chaxun</span>()</span></span><br><span class="line">{</span><br><span class="line">    SqlAccess sql = <span class="keyword">new</span> SqlAccess();</span><br><span class="line">    <span class="built_in">string</span>[] inputitem = <span class="keyword">new</span> <span class="built_in">string</span>[<span class="number">7</span>];</span><br><span class="line">    <span class="built_in">string</span>[] items = { <span class="string">"*"</span> };</span><br><span class="line">    <span class="built_in">string</span> tablename = <span class="string">"books"</span>;</span><br><span class="line">    <span class="built_in">string</span> bookname = input_bookname.text;</span><br><span class="line">    DataSet ds = sql.SelectWhere(tablename, items, bookname);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (ds != <span class="literal">null</span>)</span><br><span class="line">    {</span><br><span class="line">        DataTable table = ds.Tables[<span class="number">0</span>];</span><br><span class="line">        <span class="keyword">foreach</span> (DataRow row <span class="keyword">in</span> table.Rows)</span><br><span class="line">        {</span><br><span class="line">            <span class="built_in">string</span> str = <span class="string">""</span>;</span><br><span class="line">            <span class="keyword">foreach</span> (DataColumn column <span class="keyword">in</span> table.Columns)</span><br><span class="line">            {</span><br><span class="line">                Debug.Log(row[column] + <span class="string">"aa"</span>);</span><br><span class="line">                str += row[column] + <span class="string">" "</span>;</span><br><span class="line">            }</span><br><span class="line">            </span><br><span class="line">            Debug.Log(str);</span><br><span class="line">            <span class="built_in">string</span>[] strSplit = str.Split();</span><br><span class="line"></span><br><span class="line">            <span class="keyword">foreach</span> (<span class="keyword">var</span> item <span class="keyword">in</span> strSplit)</span><br><span class="line">            {</span><br><span class="line">                Debug.Log(item + <span class="string">" "</span>);</span><br><span class="line">            }</span><br><span class="line">            nameinput.text = strSplit[<span class="number">0</span>];</span><br><span class="line">            autherinput.text = strSplit[<span class="number">1</span>];</span><br><span class="line">            producerinput.text = strSplit[<span class="number">2</span>];</span><br><span class="line">            ageinput.text = strSplit[<span class="number">3</span>];</span><br><span class="line">            tanslaterinput.text = strSplit[<span class="number">4</span>];</span><br><span class="line">            starinput.text = strSplit[<span class="number">5</span>];</span><br><span class="line">            borrowinput.text = strSplit[<span class="number">6</span>];</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">   </span><br><span class="line"></span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">queren</span>()</span></span><br><span class="line">{</span><br><span class="line">    <span class="keyword">if</span> (input_bookname.text != <span class="string">""</span>)</span><br><span class="line">    {</span><br><span class="line">        SqlAccess sql = <span class="keyword">new</span> SqlAccess();</span><br><span class="line"></span><br><span class="line">        <span class="built_in">string</span> tablename = <span class="string">"books"</span>;</span><br><span class="line"></span><br><span class="line">        <span class="built_in">string</span> deletename = input_bookname.text;</span><br><span class="line">        DataSet ds1 = sql.Delete(tablename, deletename);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="built_in">string</span> bookname = nameinput.text;</span><br><span class="line">        <span class="built_in">string</span> auther = autherinput.text;</span><br><span class="line">        <span class="built_in">string</span> producer = producerinput.text;</span><br><span class="line">        <span class="built_in">string</span> age = ageinput.text;</span><br><span class="line">        <span class="built_in">string</span> translate = tanslaterinput.text;</span><br><span class="line">        <span class="built_in">string</span> star = starinput.text;</span><br><span class="line">        <span class="built_in">string</span> borrowed = borrowinput.text;</span><br><span class="line">        <span class="built_in">string</span>[] datavalues = <span class="keyword">new</span> <span class="built_in">string</span>[] { bookname, auther, producer, age, translate, star, borrowed };</span><br><span class="line">        DataSet ds2 = sql.Additem(tablename, datavalues);</span><br><span class="line"></span><br><span class="line">        confcanvas.SetActive(<span class="literal">false</span>);</span><br><span class="line">        showtext.color = <span class="keyword">new</span> Color(<span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>);<span class="comment">//只要点击按钮就会把文字的阿尔法值设置为1</span></span><br><span class="line">        Alpha = <span class="number">1</span>;</span><br><span class="line">        colorOrgion.a = <span class="number">1.0f</span>;</span><br><span class="line">        timer.Start(); <span class="comment">//开始计时，2秒之后执行Timer_Elapsed方法；</span></span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">queren1</span>()</span></span><br><span class="line">{</span><br><span class="line">    <span class="keyword">if</span> (input_bookname.text != <span class="string">""</span>)</span><br><span class="line">    {</span><br><span class="line">        SqlAccess sql = <span class="keyword">new</span> SqlAccess();</span><br><span class="line"></span><br><span class="line">        <span class="built_in">string</span> tablename = <span class="string">"books"</span>;</span><br><span class="line"></span><br><span class="line">        <span class="built_in">string</span> deletename = input_bookname.text;</span><br><span class="line">        DataSet ds1 = sql.Delete(tablename, deletename);</span><br><span class="line"></span><br><span class="line">        confcanvas1.SetActive(<span class="literal">false</span>);</span><br><span class="line">        Alpha = <span class="number">1</span>;</span><br><span class="line">        colorOrgion.a = <span class="number">1.0f</span>;</span><br><span class="line">        timer.Start(); <span class="comment">//开始计时，2秒之后执行Timer_Elapsed方法；</span></span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">xianshi</span>()</span></span><br><span class="line">{</span><br><span class="line">    confcanvas.SetActive(<span class="literal">true</span>);</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">quxiao</span>()</span></span><br><span class="line">{</span><br><span class="line">    confcanvas.SetActive(<span class="literal">false</span>);</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">xianshi1</span>()</span></span><br><span class="line">{</span><br><span class="line">    confcanvas1.SetActive(<span class="literal">true</span>);</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">quxiao1</span>()</span></span><br><span class="line">{</span><br><span class="line">    confcanvas1.SetActive(<span class="literal">false</span>);</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">Timer_Elapsed</span>(<span class="params"><span class="built_in">object</span> sender, ElapsedEventArgs e</span>)</span></span><br><span class="line">{</span><br><span class="line">    isbeclikck = <span class="literal">true</span>;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<h3 id="7、图表界面"><a href="#7、图表界面" class="headerlink" title="7、图表界面"></a>7、图表界面</h3><h4 id="Ⅰ、界面绘制及功能介绍-5"><a href="#Ⅰ、界面绘制及功能介绍-5" class="headerlink" title="Ⅰ、界面绘制及功能介绍"></a>Ⅰ、界面绘制及功能介绍</h4><p><img src="https://s2.loli.net/2022/07/26/WRg3ZJlUpyqYmKr.png" alt="image-20220628021037129"></p>
<p>该界面有一个饼状图和一个柱状图</p>
<p>上图为初始化状态</p>
<p>程序运行后</p>
<p><img src="https://s2.loli.net/2022/07/26/LfVbdzgcnQihvAt.png" alt="image-20220628021210340"></p>
<p>这两个图表会显示全部书籍的豆瓣评分分布状态</p>
<p>将鼠标移到饼状图的各个分布上，还会实现突出显示功能</p>
<p>点击饼状图的副标题，可选择是否隐藏该分部</p>
<p><img src="https://s2.loli.net/2022/07/26/fH4PnC9MN2XVTFc.png" alt="image-20220628021413705"></p>
<p>【注】底部柱状图x轴的乱码属于编译编码问题，在程序打包后即可解决</p>
<h4 id="Ⅱ、功能实现-5"><a href="#Ⅱ、功能实现-5" class="headerlink" title="Ⅱ、功能实现"></a>Ⅱ、功能实现</h4><p>图表绘制调用了Unity内置的动画状态机实现</p>
<p>图表数据的更新赋值调用如下函数实现，该函数在 MainCanva.cs 中被调用。</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">xiugai</span>()</span></span><br><span class="line">{</span><br><span class="line">    <span class="built_in">int</span> a = <span class="number">0</span>;</span><br><span class="line">    <span class="built_in">int</span> b = <span class="number">0</span>;</span><br><span class="line">    <span class="built_in">int</span> c = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    selcanva.gameObject.SetActive(<span class="literal">false</span>);</span><br><span class="line">    addcanva.gameObject.SetActive(<span class="literal">false</span>);</span><br><span class="line">    altercanva.gameObject.SetActive(<span class="literal">false</span>);</span><br><span class="line">    showchartcanva.gameObject.SetActive(<span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">    SqlAccess sql = <span class="keyword">new</span> SqlAccess();</span><br><span class="line">    <span class="built_in">string</span>[] items = { <span class="string">"star"</span> };</span><br><span class="line">    <span class="built_in">string</span> tablename = <span class="string">"books"</span>;</span><br><span class="line">    <span class="built_in">string</span> bookname = <span class="literal">null</span>;</span><br><span class="line">    DataSet ds = sql.SelectWhere(tablename, items, bookname);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (ds != <span class="literal">null</span>)</span><br><span class="line">    {</span><br><span class="line">        DataTable table = ds.Tables[<span class="number">0</span>];</span><br><span class="line">        <span class="keyword">foreach</span> (DataRow row <span class="keyword">in</span> table.Rows)</span><br><span class="line">        {</span><br><span class="line">            <span class="built_in">string</span> str = <span class="string">""</span>;</span><br><span class="line">            <span class="keyword">foreach</span> (DataColumn column <span class="keyword">in</span> table.Columns)</span><br><span class="line">            {</span><br><span class="line">                str += row[column];</span><br><span class="line">                <span class="built_in">float</span> num = <span class="built_in">float</span>.Parse(str);</span><br><span class="line">                <span class="keyword">if</span> (num &gt;= <span class="number">9.0f</span>)</span><br><span class="line">                    a++;</span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">if</span> (num &lt;= <span class="number">8.0f</span>)</span><br><span class="line">                    c++;</span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                    b++;</span><br><span class="line">                <span class="comment">//stars.Add(float.Parse(str));</span></span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    chart.UpdateData(<span class="number">0</span>, <span class="number">0</span>, a);</span><br><span class="line">    chart.UpdateData(<span class="number">0</span>, <span class="number">1</span>, b);</span><br><span class="line">    chart.UpdateData(<span class="number">0</span>, <span class="number">2</span>, c);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> yAxis = barchart.GetChartComponent&lt;YAxis&gt;();</span><br><span class="line">    yAxis.minMaxType = Axis.AxisMinMaxType.Default;</span><br><span class="line"></span><br><span class="line">    barchart.RemoveData();</span><br><span class="line">    serie = barchart.AddSerie&lt;Bar&gt;(<span class="string">"Star"</span>);</span><br><span class="line"></span><br><span class="line">    barchart.AddXAxisData(<span class="string">"小于8.0"</span>);</span><br><span class="line">    barchart.AddData(<span class="number">0</span>, c);</span><br><span class="line">    barchart.AddXAxisData(<span class="string">"8.0-9.0"</span>);</span><br><span class="line">    barchart.AddData(<span class="number">0</span>, b);</span><br><span class="line">    barchart.AddXAxisData(<span class="string">"大于9.0"</span> );</span><br><span class="line">    barchart.AddData(<span class="number">0</span>, a);</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<h2 id="五、实验总结及心得"><a href="#五、实验总结及心得" class="headerlink" title="五、实验总结及心得"></a><strong>五、实验总结及心得</strong></h2><p>（略）</p>


      

    </section>
    
      <section class='ArticleMeta'>
          <div>
            发布于&nbsp;
            <time datetime="2022-07-27T09:47:18.096Z" itemprop="datePublished">
              2022-07-27
            </time>
          </div>
          
            <div>
              tags: 
  <li class="meta-text">
  { <a href="/tags/Unity/">Unity</a> }
  </li>

  <li class="meta-text">
  { <a href="/tags/MySQL/">MySQL</a> }
  </li>


            </div>
          
      </section>
    
    
</article>

  
</div>

            <footer>
    <div>© 2022 - 易安亦难安 </div>
    <div>
        <span>
            Powered by <a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a>
        </span>
        ,
        <span>
            Theme - <a target="_blank" rel="noopener" href="https://github.com/nameoverflow/hexo-theme-icalm">Icalm</a>
        </span>
    </div>
</footer>

        </div>
    </div>
</div>

<script src="/js/pager/dist/singlepager.js"></script>

<script>
var sp = new Pager('data-pager-shell')

</script>
</body>
</html>